(function(){this.L7=this.L7||{};this.L7.global=this;Object.defineProperty(this.L7,"useWebGL",{get:function(){return this._useWebGL},set:function(a){if(this.hasOwnProperty("_useWebGL"))throw Error("You can only set useWebGL once");this._useWebGL=a}});this.L7.isFirefox=-1<window.navigator.userAgent.toLowerCase().indexOf("firefox");this.L7.isChrome=-1<window.navigator.userAgent.toLowerCase().indexOf("chrome");this.L7.isSupportedBrowser=this.L7.isFirefox||this.L7.isChrome;this.L7.isWebGLAvailable=function(){var a=
document.createElement("canvas");if(!a)return!1;try{return!!a.getContext("experimental-webgl")}catch(b){return!1}}()})();
(function(){L7.AnimationFactory=function(a,b){this._owner=a;this._board=b;this._buildStack=[];this._targetStack=[];this._addedAnis=[]};L7.AnimationFactory.prototype={_getBoard:function(){return this._board||this._owner.board},_determineTargets:function(a){return a.targets?a.targets:this._owner.getAnimationTargets(a.filter)},_addAnimationToBoard:function(a){this._addedAnis.push(a);this._getBoard().addDaemon(a)},_addParentAnimation:function(a,b,c,d){c=new c(d);b&&(d=this._determineTargets(b),_.isArray(d)||
(d=[d]),this._targetStack.push(d));this._buildStack.push(c);a(this);this._buildStack.pop();b&&this._targetStack.pop();0===this._buildStack.length?this._addAnimationToBoard(c):this._buildStack.last.children.add(c);return c},_addAnimation:function(a,b){a.targets||(a.targets="undefined"!==typeof a.filter?this._owner.getAnimationTargets(a.filter):0<this._targetStack.length?this._targetStack.last:this._owner.getAnimationTargets());_.isArray(a.targets)||(a.targets=[a.targets]);var c=new b(a);0===this._buildStack.length?
this._addAnimationToBoard(c):this._buildStack.last.children.add(c);return c},disco:function(a){return this._addAnimation(a,L7.Disco)},shimmer:function(a){return this._addAnimation(a,L7.Shimmer)},plasma:function(a){return this._addAnimation(a,L7.Plasma)},setProperty:function(a){a.duration=0;a.from=a.to=a.value;return this.tween(a)},copyProperty:function(a){return this._addAnimation(a,L7.CopyProperty)},tween:function(a){return this._addAnimation(a,L7.Tween)},frame:function(a){return this._addAnimation(a,
L7.Frame)},fadeIn:function(a){return this._addAnimation(a,L7.FadeIn)},sequence:function(a,b){return this.repeat(1,a,b)},together:function(a,b){var c,d;_.isFunction(a)?d=a:(c=a,d=b);return this._addParentAnimation(d,c,L7.Together)},repeat:function(a,b,c){var d;_.isFunction(b)||(d=b,b=c);return this._addParentAnimation(b,d,L7.Repeat,a)},wait:function(a){return this.waitBetween(a,a)},waitBetween:function(a,b){return this._addAnimation({min:a,max:b},L7.Wait)},invoke:function(a){return this._addAnimation({func:a},
L7.Invoke)},end:function(){var a=this._buildStack.first;if(a){var b=this;return this.invoke(function(){b._getBoard().removeDaemon(a)})}},die:function(){var a=this._getBoard();this._addedAnis.forEach(function(b){a.removeDaemon(b)})}}})();(function(){L7.CopyProperty=function(a){_.extend(this,a)};L7.CopyProperty.prototype={reset:function(){},update:function(){if(!this.done&&!this.disabled){for(var a,b=0;b<this.targets.length;++b)a=this.targets[b],a[this.destProperty]=a[this.srcProperty];this.done=!0}}}})();
(function(){var a=[255,255,255,0.9],b=[255,255,255,0.6];L7.Disco=function(a){_.extend(this,a);this.reset()};L7.Disco.prototype={reset:function(){this.done=!1;this.even=!0;this._discoCount=this._elapsed=0},update:function(a){this.done||(this._elapsed+=a,this._elapsed>=this.rate&&(this.even=!this.even,this._doDisco(this.even,this.targets,this.width),this._elapsed-=this.rate,++this._discoCount),this.done=2<=this._discoCount)},_doDisco:function(c,d,e){for(var f=0;f<d.length;++f){var g=f%e;0===g&&(c=!c);
d[f].overlayColor=c?0===(g&1)?a:b:1===(g&1)?a:b}}}})();L7.Easing=L7.Easing||{};L7.Easing.linearTween=function(a,b,c,d){return c*a/d+b};L7.Easing.easeInQuad=function(a,b,c,d){return c*(a/=d)*a+b};L7.Easing.easeOutQuad=function(a,b,c,d){return-c*(a/=d)*(a-2)+b};L7.Easing.easeInOutQuad=function(a,b,c,d){return 1>(a/=d/2)?c/2*a*a+b:-c/2*(--a*(a-2)-1)+b};L7.Easing.easeInCubic=function(a,b,c,d){return c*(a/=d)*a*a+b};L7.Easing.easeOutCubic=function(a,b,c,d){return c*((a=a/d-1)*a*a+1)+b};
L7.Easing.easeInOutCubic=function(a,b,c,d){return 1>(a/=d/2)?c/2*a*a*a+b:c/2*((a-=2)*a*a+2)+b};L7.Easing.easeInQuart=function(a,b,c,d){return c*(a/=d)*a*a*a+b};L7.Easing.easeOutQuart=function(a,b,c,d){return-c*((a=a/d-1)*a*a*a-1)+b};L7.Easing.easeInOutQuart=function(a,b,c,d){return 1>(a/=d/2)?c/2*a*a*a*a+b:-c/2*((a-=2)*a*a*a-2)+b};L7.Easing.easeInQuint=function(a,b,c,d){return c*(a/=d)*a*a*a*a+b};L7.Easing.easeOutQuint=function(a,b,c,d){return c*((a=a/d-1)*a*a*a*a+1)+b};
L7.Easing.easeInOutQuint=function(a,b,c,d){return 1>(a/=d/2)?c/2*a*a*a*a*a+b:c/2*((a-=2)*a*a*a*a+2)+b};L7.Easing.easeInSine=function(a,b,c,d){return-c*Math.cos(a/d*(Math.PI/2))+c+b};L7.Easing.easeOutSine=function(a,b,c,d){return c*Math.sin(a/d*(Math.PI/2))+b};L7.Easing.easeInOutSine=function(a,b,c,d){return-c/2*(Math.cos(Math.PI*a/d)-1)+b};L7.Easing.easeInExpo=function(a,b,c,d){return 0==a?b:c*Math.pow(2,10*(a/d-1))+b};
L7.Easing.easeOutExpo=function(a,b,c,d){return a==d?b+c:c*(-Math.pow(2,-10*a/d)+1)+b};L7.Easing.easeInOutExpo=function(a,b,c,d){return 0==a?b:a==d?b+c:1>(a/=d/2)?c/2*Math.pow(2,10*(a-1))+b:c/2*(-Math.pow(2,-10*--a)+2)+b};L7.Easing.easeInCirc=function(a,b,c,d){return-c*(Math.sqrt(1-(a/=d)*a)-1)+b};L7.Easing.easeOutCirc=function(a,b,c,d){return c*Math.sqrt(1-(a=a/d-1)*a)+b};L7.Easing.easeInOutCirc=function(a,b,c,d){return 1>(a/=d/2)?-c/2*(Math.sqrt(1-a*a)-1)+b:c/2*(Math.sqrt(1-(a-=2)*a)+1)+b};
L7.Easing.easeInElastic=function(a,b,c,d,e,f){if(0==a)return b;if(1==(a/=d))return b+c;f||(f=0.3*d);e<Math.abs(c)?(e=c,c=f/4):c=f/(2*Math.PI)*Math.asin(c/e);return-(e*Math.pow(2,10*(a-=1))*Math.sin(2*(a*d-c)*Math.PI/f))+b};L7.Easing.easeOutElastic=function(a,b,c,d,e,f){if(0==a)return b;if(1==(a/=d))return b+c;f||(f=0.3*d);if(e<Math.abs(c))var e=c,g=f/4;else g=f/(2*Math.PI)*Math.asin(c/e);return e*Math.pow(2,-10*a)*Math.sin(2*(a*d-g)*Math.PI/f)+c+b};
L7.Easing.easeInOutElastic=function(a,b,c,d,e,f){if(0==a)return b;if(2==(a/=d/2))return b+c;f||(f=1.5*0.3*d);if(e<Math.abs(c))var e=c,g=f/4;else g=f/(2*Math.PI)*Math.asin(c/e);return 1>a?-0.5*e*Math.pow(2,10*(a-=1))*Math.sin(2*(a*d-g)*Math.PI/f)+b:0.5*e*Math.pow(2,-10*(a-=1))*Math.sin(2*(a*d-g)*Math.PI/f)+c+b};L7.Easing.easeInBack=function(a,b,c,d,e){void 0==e&&(e=1.70158);return c*(a/=d)*a*((e+1)*a-e)+b};
L7.Easing.easeOutBack=function(a,b,c,d,e){void 0==e&&(e=1.70158);return c*((a=a/d-1)*a*((e+1)*a+e)+1)+b};L7.Easing.easeInOutBack=function(a,b,c,d,e){void 0==e&&(e=1.70158);return 1>(a/=d/2)?c/2*a*a*(((e*=1.525)+1)*a-e)+b:c/2*((a-=2)*a*(((e*=1.525)+1)*a+e)+2)+b};L7.Easing.easeInBounce=function(a,b,c,d){return c-L7.Easing.easeOutBounce(d-a,0,c,d)+b};
L7.Easing.easeOutBounce=function(a,b,c,d){return(a/=d)<1/2.75?7.5625*c*a*a+b:a<2/2.75?c*(7.5625*(a-=1.5/2.75)*a+0.75)+b:a<2.5/2.75?c*(7.5625*(a-=2.25/2.75)*a+0.9375)+b:c*(7.5625*(a-=2.625/2.75)*a+0.984375)+b};L7.Easing.easeInOutBounce=function(a,b,c,d){return a<d/2?0.5*L7.Easing.easeInBounce(2*a,0,c,d)+b:0.5*L7.Easing.easeOutBounce(2*a-d,0,c,d)+0.5*c+b};
(function(){L7.FadeIn=function(a){_.extend(this,a);this.reset();this._easeFunc=(this._easeFunc=L7.Easing[this.easing||"linearTween"])||Math.linearTween};L7.FadeIn.prototype={reset:function(){this._elapsed=0;this.done=this._elapsed>=this.duration;this._initted=!1},_initTargets:function(){this.targets.forEach(function(a){a.color[3]=0})},update:function(a){this._initted||(this._initTargets(),this._initted=!0);if(!this.done&&!this.disabled){this._elapsed+=a;this._elapsed>this.duration&&(this._elapsed=
this.duration,this.done=!0);for(var a=this.targets.length,b=this._easeFunc(this._elapsed,0,1,this.duration);a--;)this.targets[a].color[3]=b}}}})();
(function(){L7.Frame=function(a){_.extend(this,a);this.pieceSetIndex=this.pieceSetIndex||0;this.reset()};L7.Frame.prototype={reset:function(){this._curFrame=this._elapsed=0;this._initted=this.done=!1},_initTargets:function(){this.targets.forEach(function(a){a.setFrame(this.pieceSetIndex,0);a._frameDir=1;a._curFrame=0},this)},update:function(a){this._initted||(this._initTargets(),this._initted=!0);!this.done&&!this.disabled&&(this._elapsed+=a,this._elapsed>=this.rate&&(this._elapsed-=this.rate,this._nextFrame()))},
_nextFrame:function(){var a=this.looping,b=this.pieceSetIndex;this.targets.forEach(function(c){var d=c.pieceSets[b].length-1;c._curFrame+=c._frameDir;0>c._curFrame&&(c._curFrame=1,c._frameDir=1);c._curFrame>d&&("backforth"===a?(c._curFrame=d-1,c._frameDir=-1):c._curFrame=0);c.setFrame(b,c._curFrame)})}}})();(function(){L7.Invoke=function(a){_.extend(this,a);this.reset()};L7.Invoke.prototype={reset:function(){this.done=!1},update:function(){this.done||(this.func(),this.done=!0)}}})();
(function(){L7.Plasma=function(a){_.extend(this,a);this._width=this._determineDim(this.targets,"x");this._height=this._determineDim(this.targets,"y");this._paletteOffset=0;this._palette=this._createPalette();this.reset()};L7.Plasma.prototype={reset:function(){this.done=!1;this._elapsed=0;this._doPlasma(this._width,this._height,this.targets,this._paletteOffset)},update:function(a){this._elapsed+=a;this._elapsed>=this.rate&&(this._paletteOffset+=1,this.done=!0)},_createPalette:function(){for(var a=
[],b=this.weights&&_.isNumber(this.weights[0])?this.weights[0]:1,c=this.weights&&_.isNumber(this.weights[1])?this.weights[1]:1,d=this.weights&&_.isNumber(this.weights[2])?this.weights[2]:1,e=this.alpha||1,f=this.noise||1,g=0,j,l,k;256>g;g++)j=~~(128+128*Math.sin(Math.PI*g/(32/f))),l=~~(128+128*Math.sin(Math.PI*g/(64/f))),k=~~(128+128*Math.sin(Math.PI*g/(128/f))),j=Math.min(255,j*b),l=Math.min(255,l*c),k=Math.min(255,k*d),a[g]=[j,l,k,e];return a},_determineDim:function(a,b){var c=Math.min.apply(null,
a.map(function(a){return a.position[b]}));return Math.max.apply(null,a.map(function(a){return a.position[b]}))-c+1},_doPlasma:function(a,b,c,d){for(var e=0,f;e<b;++e)for(f=0;f<a;++f){var g=c[a*e+f];g&&(g.overlayColor=this._palette[~~(0.25*(128*Math.sin(0.0625*f)+256+128*Math.sin(0.03125*e)+128+128*Math.sin(0.125*Math.sqrt((f+d-a)*(f+d-a)+(e-d-b)*(e-d-b)))+128+128*Math.sin(0.125*Math.sqrt(f*f+e*e)))+d)%256])}}}})();
(function(){L7.Repeat=function(a){this.children=[];this._curCount=this._currentChild=0;this.count=a};L7.Repeat.prototype={reset:function(){this.done=!1;this._curCount=this._currentChild=0;this.children.forEach(function(a){a.reset()})},update:function(){this.done=this._curCount>=this.count;if(!this.done){var a=this.children[this._currentChild];a.update.apply(a,arguments);a.done&&(++this._currentChild,this._currentChild>=this.children.length&&(this._currentChild=0,++this._curCount,this.children.forEach(function(a){a.reset()})));
this.done=this._curCount>=this.count}}}})();
(function(){L7.Shimmer=function(a){_.extend(this,a);this.reset()};L7.Shimmer.prototype={reset:function(){this.done=!1},_initTargets:function(){var a=this.maxAlpha-this.minAlpha,b=this.color||[255,255,255,1];this.targets.forEach(function(c){c.opaque=!0;c.overlayColor=b.slice(0);c.overlayColor[3]=L7.rand(this.minAlpha,this.maxAlpha);c.shimmerRate=Math.floor(L7.rand(this.baseRate-this.baseRate*this.rateVariance,this.baseRate+this.baseRate*this.rateVariance));c.shimmerAlphaPerMilli=a/c.shimmerRate;c.shimmerDirection=
1},this)},update:function(a){this._initted||(this._initTargets(),this._initted=!0);this.done||(this.targets.forEach(function(b){b.overlayColor[3]+=a*b.shimmerAlphaPerMilli*b.shimmerDirection;var c=b.overlayColor[3];c>this.maxAlpha&&(b.shimmerDirection=-1,b.overlayColor[3]=this.maxAlpha);c<this.minAlpha&&(b.shimmerDirection=1,b.overlayColor[3]=this.minAlpha)},this),this.done=!0)}}})();
(function(){L7.Together=function(){this.children=[]};L7.Together.prototype={reset:function(){this.done=!1;this.children.forEach(function(a){a.reset()})},update:function(){if(!this.done){var a=_.toArray(arguments),b=!1;this.children.forEach(function(c){c.update.apply(c,a);c.done||(b=!0)});this.done=!b}}}})();
(function(){var a=0;L7.Tween=function(b){_.extend(this,b);this.reset();this._saveProperty=this.property+"_save_"+a++;this._nonJitteredProperty=this.property+"_nonJittered_"+a++;this._easeFunc=L7.Easing[this.easing||"linearTween"]||L7.Easing.linearTween};L7.Tween.prototype={reset:function(){this._elapsed=0;this.done=this._elapsed>=this.duration;this._initted=!1},_initTargets:function(){this.targets.forEach(function(a){a[this._saveProperty]=_.isArray(a[this._saveProperty])?a[this._saveProperty].slice(0):
a[this.property];var c=this.hasOwnProperty("from")?this.from:a[this.property];_.isUndefined(c)||(_.isArray(c)&&(c=c.slice(0)),a[this.property]=c)},this)},update:function(a){this._initted||(this._initTargets(),this._initted=!0);!this.done&&!this.disabled&&(this._elapsed+=a,this._elapsed>this.duration&&(this._elapsed=this.duration,this.done=!0),this.targets.forEach(function(a){this._tween(a)},this),this.done&&this.targets.forEach(function(a){this.restoreAfter&&(a[this.property]=a[this._saveProperty]);
delete a[this._saveProperty];delete a[this._nonJitteredProperty]},this))},_tween:function(a){if(_.isArray(a[this.property]))for(var c=a[this.property],d=0;d<c.length;++d)c[d]=this._tweenValue(this._elapsed,(this.from||a[this._saveProperty])[d],this.to[d],this.duration);else _.isNumber(a[this.property])&&(a[this.property]=this._tweenValue(this._elapsed,this.from,this.to,this.duration))},_tweenValue:function(a,c,d,e){a=this._easeFunc(a,c,d-c,e);_.isNumber(this.jitterMin)&&(a+=L7.rand(this.jitterMin,
this.jitterMax||0));return a}}})();(function(){L7.Wait=function(a){_.extend(this,a);this._specifiedDuration=this.duration;this.reset()};L7.Wait.prototype={reset:function(){this.duration=this._specifiedDuration||L7.rand(this.min,this.max);this._elapsed=0;this.done=this._elapsed>=this.duration},update:function(a){this.done||(this._elapsed+=a,this.done=this._elapsed>=this.duration)}}})();
(function(){var a={x:0,y:0};L7.Actor=function(a){_.extend(this,L7.Observable);_.extend(this,a);this.ani=new L7.AnimationFactory(this);this.position=this.position||L7.p(0,0);this.keyInputs=this.keyInputs||{};this.framesConfig?this.pieces=this._initFrames():(this.shape=this.shape||[[5]],this.pieces=this._createPieces());this._listeners={};this._offsetElapsed=0};L7.Actor.prototype={setFrame:function(a,c){var d=this.board;this.pieceSets&&(d?(d.removeActor(this),this.pieces=this.pieceSets[a][c],d.addActor(this)):
this.pieces=this.pieceSets[a][c])},_getMaxFrame:function(a){var c=0,a=a||[];a.forEach(function(a){a.forEach(function(a){a>c&&(c=a)})});return c+1},_createPiecesFromImagehorizontal:function(){var a=this.framesConfig.offset||L7.p(0,0),c=[],d=this.framesConfig.src.width,e=this._getMaxFrame(this.framesConfig.sets),f=document.createElement("canvas").getContext("2d");if("horizontal"===this.framesConfig.flip)f.translate(d,0),f.scale(-1,1),a=L7.p(d-a.x-this.framesConfig.width*e,a.y);else if(this.framesConfig.flip)throw Error("can only flip horizontally so far");
f.drawImage(this.framesConfig.src,0,0);f.restore();for(var d=this.framesConfig.anchor,e=e*this.framesConfig.width,g=0;g<e;g+=this.framesConfig.width){for(var j=f.getImageData(g+a.x,0+a.y,this.framesConfig.width,this.framesConfig.height),l=[],k=0;k<j.data.length;k+=4){var h=j.data[k+3]/255;if(h){var m=k,m=m/4,m=L7.p(m%this.framesConfig.width,Math.floor(m/this.framesConfig.width)).delta(d),h=new L7.Piece({anchorDelta:m,color:[j.data[k],j.data[k+1],j.data[k+2],h],owner:this,scale:_.isNumber(this.scale)?
this.scale:1});l.push(h)}}c.push(l)}return c},_initFrames:function(){var a=this["_createPiecesFromImage"+this.framesConfig.direction]();this.pieceSets=[];this.framesConfig.sets.forEach(function(c){for(var d=[],e=0;e<c.length;++e)d.push(a[c[e]]);this.pieceSets.push(d)},this);return this.pieceSets[this.framesConfig.initialSet][this.framesConfig.initialFrame]},getAnimationTargets:function(a){return a?this.pieces.filter(a):this.pieces},clicked:function(){this.fireEvent("click",this)},_getAnchorOffset:function(){var a,
c;for(c=0;c<this.shape.length;++c)for(a=0;a<this.shape[c].length;++a)if(this.shape[c][a]===L7.Actor.ANCHOR)return L7.p(a,c);throw Error("shape specified but lacks an anchor");},_getColor:function(a,c){return!this.color?void 0:_.isNumber(this.color[0])?this.color.slice(0):this.color[c][a].slice(0)},_createPieces:function(){for(var a=[],c=this._getAnchorOffset(),d=0;d<this.shape.length;++d)for(var e=this.shape[d],f=0;f<e.length;++f)if(this.shape[d][f]){var g=L7.p(f,d).delta(c),j=this._getColor(f,d),
g=new L7.Piece({anchorDelta:g,color:j,owner:this,scale:_.isNumber(this.scale)?this.scale:1});a.push(g)}return a},_getPiecePositionsAnchoredAt:function(a){var c=a.delta(this.position),d=[];_.each(this.pieces,function(a){d.push(this.position.add(c).add(a.anchorDelta))},this);return d},left:function(a){this.goTo(this.position.add(-a,0))},right:function(a){this.goTo(this.position.add(a,0))},up:function(a){this.goTo(this.position.add(0,-a))},down:function(a){this.goTo(this.position.add(0,a))},goBack:function(){this.goTo(this._lastPosition.clone())},
goTo:function(a){if(!this.onGoTo||this.onGoTo(this._getPiecePositionsAnchoredAt(this.position),this._getPiecePositionsAnchoredAt(a),this.board))!this.smoothMovement&&this.board?this.board.moveActor({actor:this,from:this.position,to:a}):this._nextPosition=a},die:function(a){this.board&&(this.ani.die(),this.board.removeActor(this));this.dead=!0;a||this.fireEvent("dead",this)},update:function(b,c){this._updateKeyInputs(b,c);this._updateTimers(b);this._lastTimestamp=c;if(this.smoothMovement&&this._nextPosition){this._offsetElapsed+=
b;this._offsetElapsed>=this.rate&&(this._offsetElapsed-=this.rate,this.board.moveActor({actor:this,from:this.position,to:this._nextPosition}),this.onSmoothMovement&&this.onSmoothMovement());var d=a,e=this._offsetElapsed/this.rate,f=this._nextPosition.delta(this.position),d={x:e*f.x,y:e*f.y};this.pieces.forEach(function(a){a.offset=d})}},_updateKeyInputs:function(a){var c=!1;_(this.keyInputs).each(function(d,e){if(d.repeat&&L7.Keys.down(e)||L7.Keys.downSince(e,this._lastTimestamp||0)){if(c=!0,d._elapsed=
d._elapsed||0,d._elapsed+=a,"undefined"===typeof d.enabled||d.enabled.call(this))if(!d.rate||d._elapsed>d.rate)d.handler.call(this,a),d._elapsed-=d.rate||0}else d._elapsed=0},this);if(!c&&this.onNoKeyDown)this.onNoKeyDown(a)},_updateTimers:function(a){this.timers&&_.each(this.timers,function(c){if("undefined"===typeof c.enabled||!0===c.enabled||"function"===typeof c.enabled&&c.enabled.call(this))c.elapsed=c.elapsed||0,c.elapsed+=a,c.elapsed>=c.interval&&(c.elapsed-=c.interval,c.handler.call(this))},
this)},pieceAt:function(a,c){var d,e;_.isNumber(a)?(d=a,e=c):(d=a.x,e=a.y);for(var f=this.pieces.length,g;f--;){g=this.pieces[f];var j=this.position.add(g.anchorDelta);if(j.x===d&&j.y===e)return g}}};Object.defineProperty(L7.Actor,"ANCHOR",{get:function(){return 5},enumerable:!1});Object.defineProperty(L7.Actor.prototype,"board",{get:function(){return this._board},set:function(a){var c=this._board;if((this._board=a)&&a!=c&&this.onBoardSet)this.onBoardSet()},enumerable:!0})})();
(function(){L7.Board=function(a){_.extend(this,a||{});_.extend(this,L7.Observable);L7.useWebGL?_.extend(L7.Board.prototype,L7.WebGLBoardRenderMixin):_.extend(L7.Board.prototype,L7.CanvasBoardRenderMixin);this.ani=new L7.AnimationFactory(this,this);this.size=new L7.Pair(this.width||0,this.height||0);this.borderWidth=this.borderWidth||0;this.tileSize=this.tileSize||0;this.freezeDuration=0;this._rows=[];this.tiles=[];for(a=0;a<this.height;++a){for(var b=[],c=0;c<this.width;++c){var d=new L7.Tile({x:c,
y:a,board:this});d.color=_.clone(this.defaultTileColor);b.push(d);this.tiles.push(d)}this._rows.push(b)}this.actors=[];this.freeActors=[];this.daemons=[];this.viewportWidth=Math.min(this.viewportWidth||this.width,this.width);this.viewportHeight=Math.min(this.viewportHeight||this.height,this.height);this.viewportAnchorX=this.viewportAnchor&&this.viewportAnchor.x||0;this.viewportAnchorY=this.viewportAnchor&&this.viewportAnchor.y||0;delete this.viewportAnchor;this._hitManager=new L7.HitManager};L7.Board.prototype=
{clicked:function(a){return(a=this.tileAtPixels(a))&&0<a.inhabitants.length?(a.inhabitants.last.owner.clicked(),!0):!1},dump:function(){console.log("");console.log("");this._rows.forEach(function(a){var b="";a.forEach(function(a){b=a.getColor()?a.inhabitants.length?b+"a":b+"t":b+"."});console.log(b)})},actorsOnTeam:function(a){return this.actors.filter(function(b){return b.team===a})},tilesTagged:function(a){return this.tiles.filter(function(b){return b.tag===a})},getAnimationTargets:function(a){return"tiles"===
a?this.tiles:"actors"===a?this.actors:"board"===a?[this]:_.isArray(a)?a:this.tiles},destroy:function(){},_clamp:function(a,b,c){return a<b?b:a>=c?c:a},_tileToPixels:function(a){return(this.tileSize+this.borderWidth)*a},scrollCenterOn:function(a){var b=this._tileToPixels(a.x)+this.tileSize/2,a=this._tileToPixels(a.y)+this.tileSize/2;this.viewport.centerOn(b,a)},scrollY:function(a){this.viewport&&this.viewport.scrollY(this._tileToPixels(a))},scrollX:function(a){this.viewport&&this.viewport.scrollX(this._tileToPixels(a))},
scrollXY:function(a,b){this.scrollX(a);this.scrollY(b)},column:function(a){0>a&&(a=this.width+a);for(var b=[],c=0;c<this.height;++c)b.push(this.tileAt(L7.p(a,c)));return b},row:function(a){var b=[];_.each(arguments,function(a){0>a&&(a=this.height+a);for(var d=0;d<this.width;++d)b.push(this.tileAt(L7.p(d,a)))},this);return b},rect:function(a,b,c,d){for(var e=[],f=b;f<b+d;++f)for(var g=a;g<a+c;++g)e.push(this.tileAt(g,f));return e},query:function(a){var b=[];this.tiles.forEach(function(c){a(c)&&b.push(c)});
return b},tileAt:function(a,b){var c=_.isObject(a)?a.x:a,d=_.isNumber(b)?b:a.y;return 0>d||d>=this.height||0>c||c>=this.width?null:this.tiles[d*this.width+c]},tileAtPixels:function(a,b){var c=_.isObject(a)?a.x:a,d=_.isNumber(b)?b:a.y;return this.tileAt(Math.floor((c+(this.offsetX||0))/(this.tileSize+this.borderWidth)),Math.floor((d+(this.offsetY||0))/(this.tileSize+this.borderWidth)))},pixelsForTile:function(a){return L7.p(this._tileToPixels(a.x),this._tileToPixels(a.y))},tileTopInPixels:function(a){return this._tileToPixels(a.y)},
tileBottomInPixels:function(a){return this.tileTopInPixels(a)+this.tileSize},each:function(a,b){this.tiles.forEach(a,b)},_addPieces:function(a){a.forEach(function(a){var c=this.tileAt(a.position);c&&c.add(a)},this)},removePieces:function(a){a.forEach(function(a){var c=this.tileAt(a.position);c&&c.remove(a)},this)},promote:function(a){a.pieces&&(this.removePieces(a.pieces),this._addPieces(a.pieces))},addActors:function(a){_.toArray(arguments).forEach(function(a){this.addActor(a)},this)},addActor:function(a){a.pieces&&
this._addPieces(a.pieces);this.actors.push(a);a.board=this},hasActor:function(a){return-1<this.actors.indexOf(a)},addFreeActor:function(a){this.freeActors.push(a);a.board=this},removeFreeActor:function(a){this.freeActors.remove(a);delete a.board},removeActor:function(a){a.pieces&&this.removePieces(a.pieces);this.actors.remove(a)},addDaemon:function(a){this.daemons.push(a)},removeDaemon:function(a){if(-1<this.daemons.indexOf(a)&&a.onRemove)a.onRemove(this);this.daemons.remove(a)},isOutOfBounds:function(a){for(var b=
0,c=a.pieces.length;b<c;++b){var d=a.pieces[b].position;if(0>d.x||0>d.y||d.x>=this.width||d.y>=this.height)return!0}return!1},_movePiece:function(a,b){var c=a.position,d=a.position.add(b);(c=this.tileAt(c))&&c.remove(a);(d=this.tileAt(d))&&d.add(a)},movePiece:function(a){this._movePiece(a.piece,a.delta||a.to.delta(a.from))},moveActor:function(a){var b=a.delta||a.to.delta(a.from);a.actor.pieces.forEach(function(a){this._movePiece(a,b)},this);a.actor._lastPosition=a.actor.position;a.actor.position=
a.actor.position.add(b);a.actor.onOutOfBounds&&this.isOutOfBounds(a.actor)&&a.actor.onOutOfBounds.call(a.actor)},freezeFor:function(a,b){this.freezeDuration=a;this.freezeCallback=b},_handleFreeze:function(a){return 0<this.freezeDuration?(this.freezeDuration-=a,0>=this.freezeDuration?(this.freezeDuration=0,this.freezeCallback&&this.freezeCallback(),!0):!1):!0},update:function(a,b){if(!this.freezeDuration||this._handleFreeze(a))this.actors.forEach(function(c){c.update(a,b)}),this.freeActors.forEach(function(c){c.update(a,
b)}),this.daemons.forEach(function(c){c.update(a,b,this)},this),this.detectHits&&this._hitManager.detectHits(this.tiles)}};Object.defineProperty(L7.Board.prototype,"pixelHeight",{get:function(){return this.height*(this.tileSize+this.borderWidth)+this.borderWidth},enumerable:!0});Object.defineProperty(L7.Board.prototype,"pixelWidth",{get:function(){return this.width*(this.tileSize+this.borderWidth)+this.borderWidth},enumerable:!0})})();
L7.CanvasBoardRenderMixin={render:function(a,b,c,d){this.angle&&(b.save(),b.rotate(this.angle));var c=c+(this.offsetX||0),d=d+(this.offsetY||0),e=this.borderWidth,a=this.tileSize,f=d/(a+e)|0,g=-d%(a+e),j,l=Math.min(this._rows.length,Math.ceil((d+b.canvas.height)/(a+e))),k=c/(a+e)|0,h=-c%(a+e),m,p=Math.min(this._rows[0].length,Math.ceil((c+b.canvas.width)/(a+e))),n,o,q,r=[];for(j=f;j<l;++j)if(0<=j){q=this._rows[j];for(m=k;m<p;++m)if(0<=m&&(n=q[m],o=n.getColor())){var t=n.getScale();_.isNumber(t)||
(t=1);var s=n.getOffset();if(1!==t||s&&(s.x||s.y))r.push(n),o=n.getColor(!0),t=1;o&&(this.borderFill&&(b.fillStyle=this.borderFill,b.fillRect((m-k)*(a+e)+h,(j-f)*(a+e)+g,a+2*e,e),b.fillRect((m-k)*(a+e)+h,(j-f)*(a+e)+g+a+e,a+2*e,e),b.fillRect((m-k)*(a+e)+h,(j-f)*(a+e)+g,e,a+2*e),b.fillRect((m-k)*(a+e)+h+a+e,(j-f)*(a+e)+g,e,a+2*e)),b.fillStyle=L7.Color.toCssString(o),o=Math.round(a*t),s=a/2-o/2,b.fillRect((m-k)*(a+e)+e+s+h,(j-f)*(a+e)+e+s+g,o,o))}}r.sort(function(a,c){return a.scale-c.scale});for(j=
0;j<r.length;++j)if(n=r[j],t=n.getScale(),_.isNumber(t)||(t=1),o=n.getColor())b.fillStyle=L7.Color.toCssString(o),o=a*t|0,s=n.getOffset(),m=l=0,s&&(l=a*s.x|0,m=a*s.y|0),s=a/2-o/2,b.fillRect((n.x-k)*(a+e)+e+s+h+l,(n.y-f)*(a+e)+e+s+g+m,o,o);for(j=0;j<this.freeActors.length;++j)if(e=this.freeActors[j],o=L7.Color.toCssString(e.color))b.fillStyle=o,b.fillRect(e.position.x-c,e.position.y-d,a,a);this.angle&&b.restore()}};
(function(){L7.HitManager=function(){};L7.HitManager.prototype={detectHitsForActor:function(a){for(var b=a.pieces.length;b--;){var c=a.board.tileAt(a.pieces[b].position);c&&this._detectTileHits(c)}},detectHits:function(a){a.forEach(function(a){this._detectTileHits(a)},this)},_detectTileHits:function(a){a.each(function(b){_.isObject(b.owner)&&_.isObject(b.owner.hitDetection)&&("undefined"===typeof b.owner.hitDetection.enabled||b.owner.hitDetection.enabled.call(b.owner))&&_.each(b.owner.hitDetection,
function(c,d){a.tag===d&&c.call(b.owner,a,a);a.each(function(e){e!==b&&e.owner&&e.owner.team===d&&c.call(b.owner,a,e.owner)},this)},this)},this)}}})();
(function(){L7.ParallaxBoard=function(a){_.extend(this,a);this.boards=this.boards||[];this.boards.forEach(function(a,c){a.parallaxRatio=a.parallaxRatio||0;_.isNumber(a.depth)||(a.depth=c)},this)};L7.ParallaxBoard.prototype={update:function(){var a=_.toArray(arguments);this.boards.forEach(function(b){b.update.apply(b,a)})},render:function(a,b,c,d,e){this.boards.forEach(function(f){!1!==f.visible&&f.render(a,b,c*f.parallaxRatio,d*f.parallaxRatio,e)})},clicked:function(a){for(var b=this.boards.length;b--&&
!this.boards[b].clicked(a););}};Object.defineProperty(L7.ParallaxBoard.prototype,"viewport",{get:function(){return this.viewport},set:function(a){this.boards.forEach(function(b){b.viewport=a})},enumerable:!0});Object.defineProperty(L7.ParallaxBoard.prototype,"game",{get:function(){return this.game},set:function(a){this.boards.forEach(function(b){b.game=a})},enumerable:!0})})();
(function(){L7.Piece=function(a){_.extend(this,a||{})};Object.defineProperty(L7.Piece.prototype,"position",{get:function(){return this.owner&&this.anchorDelta?this.owner.position.add(this.anchorDelta):this._position},set:function(a){this._position=a},enumerable:!0})})();
(function(){L7.SingleInhabitantTile=function(a){a=a||{};if(!_.isNumber(a.x))throw Error("Tile: x is required");if(!_.isNumber(a.y))throw Error("Tile: y is required");this.x=a.x;this.y=a.y;this.color=a.color;this.scale=a.scale;_.isNumber(this.scale)||(this.scale=1);this.board=a.board;this.inhabitant=_.isArray(a.inhabitants)?a.inhabitants[0]:null;this.position=L7.p(this.x,this.y);this.colors=[];this.composite=[]};L7.SingleInhabitantTile.prototype={at:function(){return this.inhabitant},each:function(a,
b){this.inhabitant&&a.call(b,this.inhabitant)},add:function(a){this.inhabitant=a},remove:function(a){this.inhabitant===a&&(this.inhabitant=null)},has:function(a){return this.tag===a?!0:this.inhabitant&&this.inhabitant.team===a},hasOther:function(){throw Error("not implemented");},getColor:function(a){var b=0;this.color&&(this.colors[b++]=this.color);!1!==a&&this.inhabitant&&this.inhabitant.color&&(this.colors[b++]=this.inhabitant.color);this.overlayColor&&(this.colors[b++]=this.overlayColor);if(this.colors[b-
1]&&1===this.colors[b-1][3])return this.colors[b-1];if(0<b)return L7.Color.composite(this.colors,b,this.composite),this.opaque&&(this.composite[3]=1),this.composite},getScale:function(){return this.inhabitant&&this.inhabitant.color&&this.inhabitant.scale||this.scale},getOffset:function(){return this.inhabitant&&this.inhabitant.offset},up:function(){return this.board&&this.board.tileAt(this.position.up())},down:function(){return this.board&&this.board.tileAt(this.position.down())},left:function(){return this.board&&
this.board.tileAt(this.position.left())},right:function(){return this.board&&this.board.tileAt(this.position.right())}};Object.defineProperty(L7.SingleInhabitantTile.prototype,"count",{get:function(){return this.inhabitant?1:0},enumerable:!0})})();
(function(){L7.StoryBoard=function(a){this.boardConfigs=a;this._setCurrentBoard(0);if(L7.global.location&&L7.global.location.hostname&&-1<L7.global.location.hostname.indexOf("localhost")){var b=this;window.nb=function(){b._setNextBoard()};window.pb=function(){b._setPreviousBoard()}}};L7.StoryBoard.prototype={_setCurrentBoard:function(a){this._currentBoardConfig&&this._currentBoardConfig.board&&this._currentBoardConfig.board.destroy&&this._currentBoardConfig.board.destroy();this._currentBoardIndex=
a;if(a=this.boardConfigs[a]){this._currentBoardConfig=a;var b=this._currentBoardConfig.board;this.width=b.width;this.height=b.height;this.tileSize=b.tileSize;this.borderWidth=b.borderWidth;this._currentDuration=a.duration;b.viewport=this.viewport;b.game=this.game}},_setNextBoard:function(){this._setCurrentBoard(this._currentBoardIndex+1)},_setPreviousBoard:function(){this._setCurrentBoard(this._currentBoardIndex-1)},update:function(a,b){this._currentBoardConfig&&(this._currentBoardConfig.board.update(a,
b),this._currentDuration-=a,0>=this._currentDuration&&this._setNextBoard())},render:function(){this._currentBoardConfig&&this._currentBoardConfig.board.render.apply(this._currentBoardConfig.board,arguments)},clicked:function(){this._currentBoardConfig&&this._currentBoardConfig.board.clicked.apply(this._currentBoardConfig.board,arguments)}};Object.defineProperty(L7.StoryBoard.prototype,"pixelHeight",{get:function(){return this.height*(this.tileSize+this.borderWidth)+this.borderWidth},enumerable:!0});
Object.defineProperty(L7.StoryBoard.prototype,"pixelWidth",{get:function(){return this.width*(this.tileSize+this.borderWidth)+this.borderWidth},enumerable:!0});Object.defineProperty(L7.StoryBoard.prototype,"viewport",{get:function(){return this._viewport},set:function(a){this._viewport=a;this._currentBoardConfig&&(this._currentBoardConfig.board.viewport=a)}});Object.defineProperty(L7.StoryBoard.prototype,"game",{get:function(){return this._game},set:function(a){this._game=a;this._currentBoardConfig&&
(this._currentBoardConfig.board.game=a)}})})();
(function(){L7.Tile=function(a){a=a||{};if(!_.isNumber(a.x))throw Error("Tile: x is required");if(!_.isNumber(a.y))throw Error("Tile: y is required");this.x=a.x;this.y=a.y;this.color=a.color;this.scale=a.scale;_.isNumber(this.scale)||(this.scale=1);this.board=a.board;this.inhabitants=_.clone(a.inhabitants||[]);this.position=L7.p(this.x,this.y);this.colors=[];this.composite=[]};L7.Tile.prototype={at:function(a){return this.inhabitants[a]},each:function(a,b){this.inhabitants.forEach(a,b)},add:function(a){this.inhabitants.push(a)},
remove:function(a){this.inhabitants.remove(a)},has:function(a){return this.tag===a?!0:this.inhabitants.some(function(b){return b.team===a||b.owner&&b.owner.team===a})},hasOther:function(a,b){return this.tag===a?!0:this.inhabitants.some(function(c){return c.team===a||c.owner&&c.owner.team===a&&c.owner!==b})},getColor:function(a){var b=0;this.color&&(this.colors[b++]=this.color);if(!1!==a)for(var a=0,c=this.inhabitants.length;a<c;++a){var d=this.inhabitants[a].color;d&&(this.colors[b++]=d)}this.overlayColor&&
(this.colors[b++]=this.overlayColor);if(this.colors[b-1]&&1===this.colors[b-1][3])return this.colors[b-1];if(0<b)return L7.Color.composite(this.colors,b,this.composite),this.opaque&&(this.composite[3]=1),this.composite},getScale:function(){return 0===this.inhabitants.length||!this.inhabitants.last.color?this.scale:this.inhabitants.last.scale},getOffset:function(){return 0!==this.inhabitants.length&&this.inhabitants.last.offset},up:function(){return this.board&&this.board.tileAt(this.position.up())},
down:function(){return this.board&&this.board.tileAt(this.position.down())},left:function(){return this.board&&this.board.tileAt(this.position.left())},right:function(){return this.board&&this.board.tileAt(this.position.right())}};Object.defineProperty(L7.Tile.prototype,"count",{get:function(){return this.inhabitants.length},enumerable:!0})})();
(function(){var a=[0,0,0,0],b={x:0,y:0};L7.WebGLBoardRenderMixin={render:function(a,b,e,f){this.squareVertexPositionBuffer||this._glInit(b);var a=e%(this.tileSize+this.borderWidth)+(this.offsetX||0),g=f%(this.tileSize+this.borderWidth)+(this.offsetY||0);mat4.identity(this.mvMatrix);mat4.translate(this.mvMatrix,[-a,-g,0]);b.uniformMatrix4fv(b.mvMatrixUniform,!1,this.mvMatrix);b.bindBuffer(b.ARRAY_BUFFER,this.squareVertexPositionBuffer);b.vertexAttribPointer(b.vertexPositionAttribute,this.squareVertexPositionBuffer.itemSize,
b.FLOAT,!1,0,0);b.bindBuffer(b.ARRAY_BUFFER,this.centerVertexPositionBuffer);b.vertexAttribPointer(b.centerPositionAttribute,this.centerVertexPositionBuffer.itemSize,b.FLOAT,!1,0,0);this._glSetTiles(b,e,f);b.drawArrays(b.TRIANGLES,0,this.squareVertexPositionBuffer.numItems)},_glInit:function(a){this.mvMatrix=mat4.create();this._glInitBuffer(a)},_glInitBuffer:function(a){function b(a,c,d){h[f++]=a;h[f++]=c;h[f++]=j;h[f++]=a+d;h[f++]=c;h[f++]=j;h[f++]=a+d;h[f++]=c+d;h[f++]=j;h[f++]=a;h[f++]=c;h[f++]=
j;h[f++]=a+d;h[f++]=c+d;h[f++]=j;h[f++]=a;h[f++]=c+d;h[f++]=j}function e(a,b,c,d){var e=c+2*d;h[f++]=a;h[f++]=b;h[f++]=j;h[f++]=a+e;h[f++]=b;h[f++]=j;h[f++]=a+e;h[f++]=b+d;h[f++]=j;h[f++]=a;h[f++]=b;h[f++]=j;h[f++]=a+e;h[f++]=b+d;h[f++]=j;h[f++]=a;h[f++]=b+d;h[f++]=j;var g=a+d+c;h[f++]=g;h[f++]=b;h[f++]=j;h[f++]=g+d;h[f++]=b;h[f++]=j;h[f++]=g+d;h[f++]=b+e;h[f++]=j;h[f++]=g;h[f++]=b;h[f++]=j;h[f++]=g+d;h[f++]=b+e;h[f++]=j;h[f++]=g;h[f++]=b+e;h[f++]=j;c=b+d+c;h[f++]=a;h[f++]=c;h[f++]=j;h[f++]=a+e;h[f++]=
c;h[f++]=j;h[f++]=a+e;h[f++]=c+d;h[f++]=j;h[f++]=a;h[f++]=c;h[f++]=j;h[f++]=a+e;h[f++]=c+d;h[f++]=j;h[f++]=a;h[f++]=c+d;h[f++]=j;h[f++]=a;h[f++]=b;h[f++]=j;h[f++]=a+d;h[f++]=b;h[f++]=j;h[f++]=a+d;h[f++]=b+e;h[f++]=j;h[f++]=a;h[f++]=b;h[f++]=j;h[f++]=a+d;h[f++]=b+e;h[f++]=j;h[f++]=a;h[f++]=b+e;h[f++]=j}this.squareVertexPositionBuffer=a.createBuffer();this.squareVertexPositionBuffer.itemSize=3;this.centerVertexPositionBuffer=a.createBuffer();this.centerVertexPositionBuffer.itemSize=2;a.bindBuffer(a.ARRAY_BUFFER,
this.squareVertexPositionBuffer);this.verticesPerTile=0<this.borderWidth?30:6;var f=0,g=0,j=this.depth||0,l=this.tileSize,k=this.borderWidth;this.vboWidth=Math.ceil(Math.min(this.width,this.viewport.width/(l+k)+1));this.vboHeight=Math.ceil(Math.min(this.height,this.viewport.height/(l+k)+1));for(var h=new Float32Array(this.vboWidth*this.vboHeight*this.squareVertexPositionBuffer.itemSize*this.verticesPerTile),m=new Float32Array(this.vboWidth*this.vboHeight*this.centerVertexPositionBuffer.itemSize*this.verticesPerTile),
p=0;p<this.vboHeight;++p)for(var n=0;n<this.vboWidth;++n){var o=n*(l+k)+k,q=p*(l+k)+k;0<this.borderWidth&&e(o-k,q-k,l,k);b(o,q,l);for(var r=0;r<this.verticesPerTile;++r)m[g++]=o+l/2,m[g++]=q+l/2}a.bufferData(a.ARRAY_BUFFER,h,a.STATIC_DRAW);this.squareVertexPositionBuffer.numItems=h.length/this.squareVertexPositionBuffer.itemSize;a.bindBuffer(a.ARRAY_BUFFER,this.centerVertexPositionBuffer);a.bufferData(a.ARRAY_BUFFER,m,a.STATIC_DRAW);this.colorOffsetsBuffer=a.createBuffer();this.colorOffsetsBuffer.itemSize=
6;this.colorOffsetsData=new Float32Array(this.vboWidth*this.vboHeight*this.verticesPerTile*this.colorOffsetsBuffer.itemSize);a.bindBuffer(a.ARRAY_BUFFER,this.colorOffsetsBuffer);a.bufferData(a.ARRAY_BUFFER,this.colorOffsetsData,a.DYNAMIC_DRAW)},_getTileShaderOffsetX:function(a,b,e){return 0===a||3===a||5===a?-2*(b-e)+1:2*(b+e)+1},_getTileShaderOffsetY:function(a,b,e){return 0===a||3===a||1===a?-2*(b-e)+1:2*(b+e)+1},_getBorderShaderOffsetX:function(a,b,e){return 6===a||9===a||11===a?2*(b+e)+1:18===
a||21==a||23===a?-2*(b-e)+1:1},_getBorderShaderOffsetY:function(a,b,e){return 5===a||2===a||4===a?-2*(b-e)+1:12===a||15===a||13===a?2*(b+e)+1:1},_glSetTiles:function(c,d,e){var f=this.borderWidth,g=this.tileSize,e=e/(g+f)|0,f=d/(g+f)|0,j,l,k,h,m,p,n,o,q,g=0;this.standardBorderColor=this.standardBorderColor||(this.borderFill?L7.Color.toArray(this.borderFill):a);this.colorOffsetsData=this.colorOffsetsData||new Float32Array(this.vboWidth*this.vboHeight*this.verticesPerTile*this.colorOffsetsBuffer.itemSize);
c.bindBuffer(c.ARRAY_BUFFER,this.colorOffsetsBuffer);d=e;for(e+=this.vboHeight;d<e;++d)if(0<=d&&d<this.height){q=this._rows[d];j=f;for(l=f+this.vboWidth;j<l;++j)if(0<=j&&j<this.width){k=q[j];h=k.getColor()||a;p=k.getOffset()||b;n=p.x;o=p.y;m=k.getScale();p=(m-1)/2;if(0<this.borderWidth){k=n||o||1!=m?k.color||a:h[3]?this.standardBorderColor:a;for(m=0;24>m;++m)this.colorOffsetsData[g++]=k[0]/255,this.colorOffsetsData[g++]=k[1]/255,this.colorOffsetsData[g++]=k[2]/255,this.colorOffsetsData[g++]=k[3],
this.colorOffsetsData[g++]=this._getBorderShaderOffsetX(m,n,p),this.colorOffsetsData[g++]=this._getBorderShaderOffsetY(m,o,p)}for(k=0;6>k;++k)this.colorOffsetsData[g++]=h[0]/255,this.colorOffsetsData[g++]=h[1]/255,this.colorOffsetsData[g++]=h[2]/255,this.colorOffsetsData[g++]=h[3],this.colorOffsetsData[g++]=this._getTileShaderOffsetX(k,n,p),this.colorOffsetsData[g++]=this._getTileShaderOffsetY(k,o,p)}else for(h=0;h<6*this.verticesPerTile;++h)this.colorOffsetsData[g++]=0}else for(h=0;h<6*this.verticesPerTile*
this.vboWidth;++h)this.colorOffsetsData[g++]=0;c.bufferSubData(c.ARRAY_BUFFER,0,this.colorOffsetsData);c.vertexAttribPointer(c.vertexColorAttribute,4,c.FLOAT,!1,4*this.colorOffsetsBuffer.itemSize,0);c.vertexAttribPointer(c.offsetsAttribute,2,c.FLOAT,!1,4*this.colorOffsetsBuffer.itemSize,16)}}})();
(function(){function a(a){var a=a.substring(1),b=a.substring(0,2),e=a.substring(2,4),a=a.substring(4,6);return result=[parseInt(b,16),parseInt(e,16),parseInt(a,16),1]}L7.Color={toCssString:function(a){return 3===a.length?"rgb("+Math.round(a[0])+","+Math.round(a[1])+","+Math.round(a[2])+")":"rgba("+Math.round(a[0])+","+Math.round(a[1])+","+Math.round(a[2])+","+a[3]+")"},isBuiltInString:function(a){return"string"!==typeof a?!1:b.hasOwnProperty(a.toLowerCase())},isHexString:function(a){if("string"!==
typeof a||"#"!==a[0]||7!==a.length)return!1;for(var a=a.toUpperCase(),b=1,e=a.length;b<e;++b){var f=a[b];if("0">f||"F"<f)return!1}return!0},isOpaque:function(a){return this.isHexString(a)||this.isBuiltInString(a)?!0:(a=this.toArray(a))&&1===a[3]},isRgbString:function(a){return"string"!==typeof a||10>a.length||0!==a.indexOf("rgb")||")"!==a[a.length-1]||"("!==a[3]&&"("!==a[4]?!1:!0},toArray:function(c){if(_.isArray(c)&&4===c.length)return c;if(this.isHexString(c))return a(c);if(this.isBuiltInString(c))return a(b[c]);
if(this.isRgbString(c)){for(var d=c.indexOf("("),e=[],c=c.substring(d+1).split(","),d=0,f=c.length;d<f;++d)e.push(parseFloat(c[d]));3===e.length&&e.push(1);return e}},fromArrayToHex:function(a,b){for(var e="#",f=b&&b.includeAlpha&&4===a.length?4:3,g=0;g<f;++g){var j=a[g].toString(16);2>j.length&&(j="0"+j);e+=j}return e.toUpperCase()},composite:function(a,b,e){e[0]=e[1]=e[2]=e[3]=1;for(var f=0;f<b;++f){for(var g=e,j=a[f],l=j[3],k=g[3],h=1-l,m=void 0,p=void 0,m=0,p=g.length-1;m<p;++m)g[m]=Math.round(j[m]*
l+g[m]*k*h);g[3]=(g[3]+j[3])/2}},fromFloats:function(a,b,e,f){return[Math.round(255*a),Math.round(255*b),Math.round(255*e),f]}};var b={aliceblue:"#F0F8FF",antiquewhite:"#FAEBD7",aqua:"#00FFFF",aquamarine:"#7FFFD4",azure:"#F0FFFF",beige:"#F5F5DC",bisque:"#FFE4C4",black:"#000000",blanchedalmond:"#FFEBCD",blue:"#0000FF",blueviolet:"#8A2BE2",brown:"#A52A2A",burlywood:"#DEB887",cadetblue:"#5F9EA0",chartreuse:"#7FFF00",chocolate:"#D2691E",coral:"#FF7F50",cornflowerblue:"#6495ED",cornsilk:"#FFF8DC",crimson:"#DC143C",
cyan:"#00FFFF",darkblue:"#00008B",darkcyan:"#008B8B",darkgoldenrod:"#B8860B",darkgray:"#A9A9A9",darkgrey:"#A9A9A9",darkgreen:"#006400",darkkhaki:"#BDB76B",darkmagenta:"#8B008B",darkolivegreen:"#556B2F",darkorange:"#FF8C00",darkorchid:"#9932CC",darkred:"#8B0000",darksalmon:"#E9967A",darkseagreen:"#8FBC8F",darkslateblue:"#483D8B",darkslategray:"#2F4F4F",darkslategrey:"#2F4F4F",darkturquoise:"#00CED1",darkviolet:"#9400D3",deeppink:"#FF1493",deepskyblue:"#00BFFF",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1E90FF",
firebrick:"#B22222",floralwhite:"#FFFAF0",forestgreen:"#228B22",fuchsia:"#FF00FF",gainsboro:"#DCDCDC",ghostwhite:"#F8F8FF",gold:"#FFD700",goldenrod:"#DAA520",gray:"#808080",grey:"#808080",green:"#008000",greenyellow:"#ADFF2F",honeydew:"#F0FFF0",hotpink:"#FF69B4",indianred:"#CD5C5C",indigo:"#4B0082",ivory:"#FFFFF0",khaki:"#F0E68C",lavender:"#E6E6FA",lavenderblush:"#FFF0F5",lawngreen:"#7CFC00",lemonchiffon:"#FFFACD",lightblue:"#ADD8E6",lightcoral:"#F08080",lightcyan:"#E0FFFF",lightgoldenrodyellow:"#FAFAD2",
lightgray:"#D3D3D3",lightgrey:"#D3D3D3",lightgreen:"#90EE90",lightpink:"#FFB6C1",lightsalmon:"#FFA07A",lightseagreen:"#20B2AA",lightskyblue:"#87CEFA",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#B0C4DE",lightyellow:"#FFFFE0",lime:"#00FF00",limegreen:"#32CD32",linen:"#FAF0E6",magenta:"#FF00FF",maroon:"#800000",mediumaquamarine:"#66CDAA",mediumblue:"#0000CD",mediumorchid:"#BA55D3",mediumpurple:"#9370D8",mediumseagreen:"#3CB371",mediumslateblue:"#7B68EE",mediumspringgreen:"#00FA9A",
mediumturquoise:"#48D1CC",mediumvioletred:"#C71585",midnightblue:"#191970",mintcream:"#F5FFFA",mistyrose:"#FFE4E1",moccasin:"#FFE4B5",navajowhite:"#FFDEAD",navy:"#000080",oldlace:"#FDF5E6",olive:"#808000",olivedrab:"#6B8E23",orange:"#FFA500",orangered:"#FF4500",orchid:"#DA70D6",palegoldenrod:"#EEE8AA",palegreen:"#98FB98",paleturquoise:"#AFEEEE",palevioletred:"#D87093",papayawhip:"#FFEFD5",peachpuff:"#FFDAB9",peru:"#CD853F",pink:"#FFC0CB",plum:"#DDA0DD",powderblue:"#B0E0E6",purple:"#800080",red:"#FF0000",
rosybrown:"#BC8F8F",royalblue:"#4169E1",saddlebrown:"#8B4513",salmon:"#FA8072",sandybrown:"#F4A460",seagreen:"#2E8B57",seashell:"#FFF5EE",sienna:"#A0522D",silver:"#C0C0C0",skyblue:"#87CEEB",slateblue:"#6A5ACD",slategray:"#708090",slategrey:"#708090",snow:"#FFFAFA",springgreen:"#00FF7F",steelblue:"#4682B4",tan:"#D2B48C",teal:"#008080",thistle:"#D8BFD8",tomato:"#FF6347",turquoise:"#40E0D0",violet:"#EE82EE",wheat:"#F5DEB3",white:"#FFFFFF",whitesmoke:"#F5F5F5",yellow:"#FFFF00",yellowgreen:"#9ACD32"}})();
(function(){L7.ColorLevelLoader=function(a,b,c,d){this.image=a;this.width=a.width;this.height=a.height;this.tileSize=b;this.borderWidth=c;this.borderFill=d||"black"};L7.ColorLevelLoader.prototype={load:function(){for(var a=new L7.Board(this),b=this._getData(),c=0;c<b.length;c+=4){var d=this._extractColor(b,c);if(0<d[3]){var e=this._getPosition(c);a.tileAt(e).color=d}}return a},_getData:function(){var a=document.createElement("canvas");a.width=this.width;a.height=this.height;a=a.getContext("2d");a.drawImage(this.image,
0,0);return a.getImageData(0,0,this.width,this.height).data},_extractColor:function(a,b){for(var c=[],d=b;d<b+4;++d)c.push(a[d]);c[3]/=255;return c},_getPosition:function(a){a=Math.floor(a/4);return L7.p(a%this.width,Math.floor(a/this.width))}}})();
(function(){L7.ImageLoader=function(a){_.extend(this,a);this.loadNow&&this.load()};L7.ImageLoader.prototype={load:function(){this._pendingCount=this.srcs.length;this._images={};var a=this;this.srcs.forEach(function(b){var c=new Image;c.onload=function(){var d=a._images,e;e=b;var f=e.lastIndexOf("."),g=e.lastIndexOf("/");-1<f&&(e=e.substring(0,f));-1<g&&(e=e.substring(g+1));e=e.replace(/[^a-zA-Z0-9]/g,"");d[e]=c;--a._pendingCount;0===a._pendingCount&&a.handler(a._images)};c.src=b})}}})();
(function(){L7.LevelLoader=function(a){_.extend(this,a);this.width=a.image.width;this.height=a.image.height};L7.LevelLoader.prototype={load:function(){for(var a=_.extend(this.boardConfig,{width:this.width,height:this.height}),b=new L7.Board(a),c={},a=this._getData(),d=0;d<a.length;d+=4){var e=this._extractColor(a,d),f=this.legend[e];if(f){var g=this._getPosition(d);if(f.hasOwnProperty("constructor")){var j=_.extend({},f.config||{},{position:g});_.isArray(f.constructor)||(f.constructor=[f.constructor]);
f.constructor.forEach(function(a){a=new a(j);c[e]=c[e]||[];c[e].push(a);b.addActor(a)})}f.tag&&(b.tileAt(g).tag=f.tag);f.color&&(b.tileAt(g).color=f.color)}}return{board:b,actors:c}},_getData:function(){var a=document.createElement("canvas");a.width=this.width;a.height=this.height;a=a.getContext("2d");a.drawImage(this.image,0,0);return a.getImageData(0,0,this.width,this.height).data},_extractColor:function(a,b){for(var c=[],d=b;d<b+3;++d)c.push(a[d]);return L7.Color.fromArrayToHex(c)},_getPosition:function(a){a=
Math.floor(a/4);return L7.p(a%this.width,Math.floor(a/this.width))}}})();(function(){L7.CanvasGameRenderer=function(a){this.viewport=a};L7.CanvasGameRenderer.prototype={init:function(a){a.style.imageRendering="-webkit-optimize-contrast"},renderFrame:function(a,b,c,d,e,f){var g=a.getContext("2d");g.clearRect(0,0,a.width,a.height);b.render(c,g,d,e,f)}}})();
(function(){var a=1E3*(1/60);window.requestAnimationFrame=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||window.oRequestAnimationFrame||function(b){window.setTimeout(b,a)};L7.Game=function(a){_.extend(this,L7.Observable);a="function"!==typeof a.render&&"function"!==typeof a.update?a:{width:a.width*(a.tileSize+a.borderWidth)+a.borderWidth,height:a.height*(a.tileSize+a.borderWidth)+a.borderWidth,board:a};_.extend(this,
a);_.bindAll(this,"_doFrame");this.viewport=new L7.Viewport(this);this.board&&(this.board.viewport=this.viewport);this.container=this.container||document.body;this.clearOutContainer&&this._clearContainer(this.container);this.renderer=L7.useWebGL?new L7.WebGLGameRenderer(this.viewport):new L7.CanvasGameRenderer(this.viewport);this._createCanvas();this.renderer.init(this.canvas);L7.Keys.init(this.canvas);L7.Mouse.init(this.canvas);this.delays=[];var c=this;L7.global.addEventListener("blur",function(){delete c._lastTimestamp});
this.board&&(this.board.game=this)};L7.Game.prototype={_clearContainer:function(a){a.innerHTML=""},_createCanvas:function(){this.canvas=document.createElement("canvas");this.canvas.width=this.viewport.width;this.canvas.height=this.viewport.height;this.container.appendChild(this.canvas);var a=this;this.canvas.addEventListener("click",function(c){a._onCanvasClick(c)},!1)},go:function(){delete this._lastTimestamp;this._doFrame(Date.now())},after:function(a,c){this.delays.add({remaining:a,handler:c})},
replaceBoard:function(a){this.board&&this.board.destroy&&this.board.destroy();this.board=a;this.board.viewport=this.viewport;this.board.game=this;this.viewport.reset()},_updateDelays:function(a){var c=[];this.delays.forEach(function(d){d.remaining-=a;0>=d.remaining&&(d.handler.call(d.scope,this),c.push(d))},this);c.forEach(function(a){this.delays.remove(a)},this)},_displayFps:function(a){a=this._frameCount/((a-this._frameCountStart)/1E3);this.fpsContainer&&(this.fpsContainer.innerHTML=(a|0)+" fps")},
_updateFps:function(a){this._frameCountStart?(++this._frameCount,4E3<a-this._frameCountStart&&(this._displayFps(a),delete this._frameCountStart)):(this._frameCountStart=a,this._frameCount=1)},_doFrame:function(b){this._hasDoneFrame=!0;this._updateFps(b);var c=b-(this._lastTimestamp||b);this._lastTimestamp=b;for(var d=c;0<d;){var e=Math.min(a,d);this._updateDelays(e);this.board.update(e,b);d-=e}this.renderer.renderFrame(this.canvas,this.board,c,this.viewport.anchorX,this.viewport.anchorY,b);this.paused||
requestAnimationFrame(this._doFrame)},_onCanvasClick:function(a){this.board.clicked(L7.p((a.x||a.clientX)-a.target.offsetLeft,(a.y||a.clientY)-a.target.offsetTop))}};Object.defineProperty(L7.Game.prototype,"paused",{get:function(){return this._paused},set:function(a){var c=this._paused;(this._paused=a)?this._hasDoneFrame||this._doFrame(Date.now()):this.go();c!==a&&this.fireEvent("pausechanged",a)}})})();
(function(){L7.Keys={arrows:{37:"left",38:"up",39:"right",40:"down"},init:function(){this._hook=window;this._keyDownListener=_.bind(this._onKeyDown,this);this._hook.addEventListener("keydown",this._keyDownListener,!1);this._keyUpListener=_.bind(this._onKeyUp,this);this._hook.addEventListener("keyup",this._keyUpListener,!1);this._downKeys={}},_getCharacter:function(a){return this.arrows[a.toString()]||String.fromCharCode(a).toLowerCase()},_onKeyDown:function(a){a=this._getCharacter(a.keyCode);this._downKeys[a]||
(this._downKeys[a]=Date.now())},_onKeyUp:function(a){delete this._downKeys[this._getCharacter(a.keyCode)]},down:function(a){return void 0!==this._downKeys[a]},downSince:function(a,b){return this.down(a)&&this._downKeys[a]>b}}})();
(function(){L7.Mouse={init:function(a){this._hook=a;this._mouseMoveListener=_.bind(this._onMouseMove,this);this._hook.addEventListener("mousemove",this._mouseMoveListener,!1);this._pos=L7.p()},_onMouseMove:function(a){this._pos=L7.p(a.offsetX,a.offsetY)}};Object.defineProperty(L7.Mouse,"position",{get:function(){return this._pos},enumerable:!0})})();
(function(){L7.Viewport=function(a){a=a||{};_.extend(this,a);_.isUndefined(this.preventOverscroll)&&(this.preventOverscroll=!1);this.anchorX=a.initialAnchor&&a.initialAnchor.x||0;this.anchorY=a.initialAnchor&&a.initialAnchor.y||0;this.width=this.width||100;this.height=this.height||100};L7.Viewport.prototype={scrollY:function(a){this.anchorY+=a},scrollX:function(a){this.anchorX+=a},centerOn:function(a,b){var c=a.y||b;this.anchorX=Math.floor((a.x||a)-this.width/2);this.anchorY=Math.floor(c-this.height/
2)},reset:function(){this.anchorY=this.anchorX=0}}})();
(function(){L7.WebGLGameRenderer=function(a){this.viewport=a};L7.WebGLGameRenderer.prototype={_getShader:function(a,b){var c=this.gl.createShader(b);this.gl.shaderSource(c,a);this.gl.compileShader(c);if(!this.gl.getShaderParameter(c,this.gl.COMPILE_STATUS))throw Error(this.gl.getShaderInfoLog(c));return c},_initShaders:function(){var a=this._getShader("precision lowp float;varying vec4 vColor;void main(void) {gl_FragColor = vColor;}",this.gl.FRAGMENT_SHADER),b=this._getShader("attribute vec3 aVertexPosition;attribute vec2 aOffsets;attribute vec2 aVertexCenter;attribute vec4 aVertexColor;uniform mat4 uMVMatrix;uniform mat4 uPMatrix;varying vec4 vColor;void main(void) {float diffX = aVertexPosition.x - aVertexCenter.x;float offsetX = (aOffsets.x * diffX) - diffX;float diffY = aVertexPosition.y - aVertexCenter.y;float offsetY = (aOffsets.y * diffY) - diffY;float offsetZ = 0.0;if(offsetX != 0.0 || offsetY != 0.0) {offsetZ = 0.1;}gl_Position = uPMatrix * uMVMatrix * vec4(aVertexPosition + vec3(offsetX, offsetY, offsetZ), 1.0);vColor = aVertexColor;}",
this.gl.VERTEX_SHADER),c=this.gl.createProgram();this.gl.attachShader(c,b);this.gl.attachShader(c,a);this.gl.linkProgram(c);if(!this.gl.getProgramParameter(c,this.gl.LINK_STATUS))throw Error("Could not initialise shaders");this.gl.useProgram(c);this.gl.vertexPositionAttribute=this.gl.getAttribLocation(c,"aVertexPosition");this.gl.enableVertexAttribArray(this.gl.vertexPositionAttribute);this.gl.offsetsAttribute=this.gl.getAttribLocation(c,"aOffsets");this.gl.enableVertexAttribArray(this.gl.offsetsAttribute);
this.gl.centerPositionAttribute=this.gl.getAttribLocation(c,"aVertexCenter");this.gl.enableVertexAttribArray(this.gl.centerPositionAttribute);this.gl.vertexColorAttribute=this.gl.getAttribLocation(c,"aVertexColor");this.gl.enableVertexAttribArray(this.gl.vertexColorAttribute);this.pMatrixUniform=this.gl.getUniformLocation(c,"uPMatrix");this.gl.mvMatrixUniform=this.gl.getUniformLocation(c,"uMVMatrix")},init:function(a){this.gl=a.getContext("experimental-webgl");this.gl.clearColor(0,0,0,1);this.gl.blendFunc(this.gl.SRC_ALPHA,
this.gl.ONE_MINUS_SRC_ALPHA);this.gl.enable(this.gl.BLEND);this.gl.enable(this.gl.DEPTH_TEST);this.pMatrix=mat4.create();this._initShaders()},renderFrame:function(a,b,c,d,e,f){this.gl.viewport(0,0,this.viewport.width,this.viewport.height);this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT);mat4.ortho(0,this.viewport.width,this.viewport.height,0,-100,100,this.pMatrix);this.gl.uniformMatrix4fv(this.pMatrixUniform,!1,this.pMatrix);b.render(c,this.gl,d,e,f)}}})();
(function(){var a=Math.PI,b=2*a,c=a/2;L7.Pair=function(a,b){this._a=a||0;this._b=b||0};L7.Pair.prototype={clone:function(){return L7.p(this.x,this.y)},equals:function(a){return a?a===this||a._a===this._a&&a._b==this._b||a.x===this._a&&a.y==this._b||a.width==this._a&&a.height==this._b:!1},up:function(){return L7.p(this.x,this.y-1)},left:function(){return L7.p(this.x-1,this.y)},right:function(){return L7.p(this.x+1,this.y)},down:function(){return L7.p(this.x,this.y+1)},add:function(a,b){return L7.p(this.x+
("number"===typeof a.x?a.x:a||0),this.y+("number"===typeof a.y?a.y:b||0))},subtract:function(a,b){x="number"===typeof a.x?a.x:a||0;y="number"===typeof a.y?a.y:b||0;return L7.p(this.x-x,this.y-y)},negate:function(){return L7.p(-this.x,-this.y)},multiply:function(a){return L7.p(this.x*a,this.y*a)},round:function(){return L7.pr(this.x,this.y)},dot:function(a){return this.x*a.x+this.y*a.y},length:function(){return Math.sqrt(this.dot(this))},normalize:function(){return this.multiply(1/this.length())},
distanceFrom:function(a){a=this.delta(a);return Math.sqrt(a.dot(a))},degreeAngleFrom:function(a){return L7.radiansToDegrees(this.radianAngleFrom(a))},radianAngleFrom:function(d){var e=this.x-d.x,d=this.y-d.y;if(0===e)return 0>d?3*c:c;if(0===d)return 0>e?a:0;var f=Math.atan(d/e);return 0<e&&0<d?f:0>e&&0<d?f+a:0>e&&0>d?f+a:f+b},toString:function(){return"["+this._a+","+this._b+"]"}};L7.Pair.prototype.delta=L7.Pair.prototype.subtract;Object.defineProperty(L7.Pair.prototype,"width",{get:function(){return this._a}});
Object.defineProperty(L7.Pair.prototype,"height",{get:function(){return this._b}});Object.defineProperty(L7.Pair.prototype,"x",{get:function(){return this._a}});Object.defineProperty(L7.Pair.prototype,"y",{get:function(){return this._b}});L7.s=function(a,b){return new L7.Pair(a,b)};L7.p=L7.s;L7.sr=function(a,b){return new L7.Pair(Math.round(a),Math.round(b))};L7.pr=L7.sr})();
(function(){L7.Observable={on:function(a,b,c){this._listeners=this._listeners||{};this._listeners[a]||(this._listeners[a]=[]);this._listeners[a].push({handler:b,scope:c})},fireEvent:function(a,b){this._listeners=this._listeners||{};var c=this._listeners[a];if(_.isArray(c)){var d=_.toArray(arguments);d.shift();_.each(c,function(a){a.handler.apply(a.scope,d)})}}}})();
(function(){function a(){return L7.rand(-1,1,!0)}var b=0;L7.ParticleSystem=function(a){_.extend(this,a);this._particles=[];this.id=b++;this._particleTeam=this.team||"particle-"+this.id;for(a=0;a<this.totalParticles;++a)this._particles.push(new L7.Actor({position:this.position.clone(),team:this._particleTeam}));this._particleCount=this._particleIndex=this._emitCounter=this._elapsed=0;this.active=this.active||!1};L7.ParticleSystem.prototype={onRemove:function(a){this.reset();this._particles.forEach(function(b){this._initParticle(b);
a.removeActor(b)},this);this._addedActors=!1},reset:function(){this._particleIndex=this._particleCount=0},_isFull:function(){return this._particleCount===this.totalParticles},_initParticle:function(b){b.rx=this.position.x+this.posVar.x*a();b.ry=this.position.y+this.posVar.y*a();var d=L7.degreesToRadians(this.angle+this.angleVar*a()),d=L7.p(Math.cos(d),Math.sin(d)),e=this.speed+this.speedVar*a(),d=d.multiply(e);b.dir={x:d.x,y:d.y};b.radialAccel=this.radialAccel+this.radialAccelVar*a();b.radialAccel&&
(b.radialAccel=0);b.tangentialAccel=this.tangentialAccel+this.tangentialAccelVar*a();b.tangentialAccel||(b.tangentialAccel=0);d=this.life+this.lifeVar*a();b.life=Math.max(0,d);d=[this.startColor[0]+this.startColorVar[0]*a(),this.startColor[1]+this.startColorVar[1]*a(),this.startColor[2]+this.startColorVar[2]*a(),this.startColor[3]+this.startColorVar[3]*a()];e=[this.endColor[0]+this.endColorVar[0]*a(),this.endColor[1]+this.endColorVar[1]*a(),this.endColor[2]+this.endColorVar[2]*a(),this.endColor[3]+
this.endColorVar[3]*a()];b.color=d;b.pieces[0].color=d;b.deltaColor=[(e[0]-d[0])/b.life,(e[1]-d[1])/b.life,(e[2]-d[2])/b.life,(e[3]-d[3])/b.life];_.isUndefined(this.startSize)?(b.size=1,b.deltaSize=0):(d=this.startSize+this.startSizeVar*a(),d=Math.max(0,d),b.size=d,_.isUndefined(this.endSize)?b.deltaSize=0:(e=this.endSize+this.endSizeVar*a(),b.deltaSize=(e-d)/b.life))},_addParticle:function(){if(this._isFull())return!1;this._initParticle(this._particles[this._particleCount]);++this._particleCount;
return!0},update:function(a,b,e){if(this.active){a/=1E3;if(this.emissionRate){b=1/this.emissionRate;for(this._emitCounter+=a;!this._isFull()&&this._emitCounter>b;)this._addParticle(),this._emitCounter-=b}this._elapsed+=a;this.active=this._elapsed<this.duration;for(this._particleIndex=0;this._particleIndex<this._particleCount;)this._updateParticle(this._particles[this._particleIndex],a,this._particleIndex);this._updateBoard(e)}},_updateParticle:function(a,b,e){if(0<a.life){a.tmp=a.tmp||{x:0,y:0};a.tmp.x=
0;a.tmp.y=0;a.radial=a.radial||{x:0,y:0};a.radial.x=0;a.radial.y=0;if(a.position.x!==this.position.x||a.position.y!==this.position.y)e=L7.p(a.rx,a.ry).normalize(),a.radial.x=e.x,a.radial.y=e.y;e=_.clone(a.radial);a.radial.x*=a.radialAccel;a.radial.y*=a.radialAccel;var f=e.x;e.x=-e.y;e.y=f;e.x*=a.tangentialAccel;e.y*=a.tangentialAccel;a.tmp.x=a.radial.x+e.x+this.gravity.x;a.tmp.y=a.radial.y+e.y+this.gravity.y;a.tmp.x*=b;a.tmp.y*=b;a.dir.x+=a.tmp.x;a.dir.y+=a.tmp.y;a.tmp.x=a.dir.x*b;a.tmp.y=a.dir.y*
b;a.rx+=a.tmp.x;a.ry+=a.tmp.y;a.goTo(L7.pr(a.rx,a.ry));a.color[0]+=a.deltaColor[0]*b;a.color[1]+=a.deltaColor[1]*b;a.color[2]+=a.deltaColor[2]*b;a.color[3]+=a.deltaColor[3]*b;a.size+=a.deltaSize*b;a.size=Math.max(0,a.size);a.pieces[0].scale=a.size;a.life-=b;++this._particleIndex}else a=this._particles[e],this._particles[e]=this._particles[this._particleCount-1],this._particles[this._particleCount-1]=a,--this._particleCount},_updateBoard:function(a){this._addedActors||(this._particles.forEach(function(b){a.addActor(b)}),
this._addedActors=!0);for(var b=L7.p(-1,-1),e=this._particleCount;e<this._particles.length;++e)this._particles[e].goTo(b)}}})();(function(a){a.glMatrixArrayType=a.MatrixArray=null;a.vec3={};a.mat3={};a.mat4={};a.quat4={};a.setMatrixArrayType=function(a){return glMatrixArrayType=MatrixArray=a};a.determineMatrixArrayType=function(){return setMatrixArrayType("undefined"!==typeof Float32Array?Float32Array:Array)};determineMatrixArrayType()})("undefined"!=typeof exports?global:this);
vec3.create=function(a){var b=new MatrixArray(3);a?(b[0]=a[0],b[1]=a[1],b[2]=a[2]):b[0]=b[1]=b[2]=0;return b};vec3.set=function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];return b};vec3.add=function(a,b,c){if(!c||a===c)return a[0]+=b[0],a[1]+=b[1],a[2]+=b[2],a;c[0]=a[0]+b[0];c[1]=a[1]+b[1];c[2]=a[2]+b[2];return c};vec3.subtract=function(a,b,c){if(!c||a===c)return a[0]-=b[0],a[1]-=b[1],a[2]-=b[2],a;c[0]=a[0]-b[0];c[1]=a[1]-b[1];c[2]=a[2]-b[2];return c};
vec3.multiply=function(a,b,c){if(!c||a===c)return a[0]*=b[0],a[1]*=b[1],a[2]*=b[2],a;c[0]=a[0]*b[0];c[1]=a[1]*b[1];c[2]=a[2]*b[2];return c};vec3.negate=function(a,b){b||(b=a);b[0]=-a[0];b[1]=-a[1];b[2]=-a[2];return b};vec3.scale=function(a,b,c){if(!c||a===c)return a[0]*=b,a[1]*=b,a[2]*=b,a;c[0]=a[0]*b;c[1]=a[1]*b;c[2]=a[2]*b;return c};
vec3.normalize=function(a,b){b||(b=a);var c=a[0],d=a[1],e=a[2],f=Math.sqrt(c*c+d*d+e*e);if(f){if(1===f)return b[0]=c,b[1]=d,b[2]=e,b}else return b[0]=0,b[1]=0,b[2]=0,b;f=1/f;b[0]=c*f;b[1]=d*f;b[2]=e*f;return b};vec3.cross=function(a,b,c){c||(c=a);var d=a[0],e=a[1],a=a[2],f=b[0],g=b[1],b=b[2];c[0]=e*b-a*g;c[1]=a*f-d*b;c[2]=d*g-e*f;return c};vec3.length=function(a){var b=a[0],c=a[1],a=a[2];return Math.sqrt(b*b+c*c+a*a)};vec3.dot=function(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]};
vec3.direction=function(a,b,c){c||(c=a);var d=a[0]-b[0],e=a[1]-b[1],a=a[2]-b[2],b=Math.sqrt(d*d+e*e+a*a);if(!b)return c[0]=0,c[1]=0,c[2]=0,c;b=1/b;c[0]=d*b;c[1]=e*b;c[2]=a*b;return c};vec3.lerp=function(a,b,c,d){d||(d=a);d[0]=a[0]+c*(b[0]-a[0]);d[1]=a[1]+c*(b[1]-a[1]);d[2]=a[2]+c*(b[2]-a[2]);return d};vec3.dist=function(a,b){var c=b[0]-a[0],d=b[1]-a[1],e=b[2]-a[2];return Math.sqrt(c*c+d*d+e*e)};
vec3.unproject=function(a,b,c,d,e){e||(e=a);var f=mat4.create(),g=new MatrixArray(4);g[0]=2*(a[0]-d[0])/d[2]-1;g[1]=2*(a[1]-d[1])/d[3]-1;g[2]=2*a[2]-1;g[3]=1;mat4.multiply(c,b,f);if(!mat4.inverse(f))return null;mat4.multiplyVec4(f,g);if(0===g[3])return null;e[0]=g[0]/g[3];e[1]=g[1]/g[3];e[2]=g[2]/g[3];return e};vec3.str=function(a){return"["+a[0]+", "+a[1]+", "+a[2]+"]"};
mat3.create=function(a){var b=new MatrixArray(9);a&&(b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],b[4]=a[4],b[5]=a[5],b[6]=a[6],b[7]=a[7],b[8]=a[8]);return b};mat3.set=function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];return b};mat3.identity=function(a){a||(a=mat3.create());a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=1;a[5]=0;a[6]=0;a[7]=0;a[8]=1;return a};
mat3.transpose=function(a,b){if(!b||a===b){var c=a[1],d=a[2],e=a[5];a[1]=a[3];a[2]=a[6];a[3]=c;a[5]=a[7];a[6]=d;a[7]=e;return a}b[0]=a[0];b[1]=a[3];b[2]=a[6];b[3]=a[1];b[4]=a[4];b[5]=a[7];b[6]=a[2];b[7]=a[5];b[8]=a[8];return b};mat3.toMat4=function(a,b){b||(b=mat4.create());b[15]=1;b[14]=0;b[13]=0;b[12]=0;b[11]=0;b[10]=a[8];b[9]=a[7];b[8]=a[6];b[7]=0;b[6]=a[5];b[5]=a[4];b[4]=a[3];b[3]=0;b[2]=a[2];b[1]=a[1];b[0]=a[0];return b};
mat3.str=function(a){return"["+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+"]"};mat4.create=function(a){var b=new MatrixArray(16);a&&(b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],b[4]=a[4],b[5]=a[5],b[6]=a[6],b[7]=a[7],b[8]=a[8],b[9]=a[9],b[10]=a[10],b[11]=a[11],b[12]=a[12],b[13]=a[13],b[14]=a[14],b[15]=a[15]);return b};
mat4.set=function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];b[9]=a[9];b[10]=a[10];b[11]=a[11];b[12]=a[12];b[13]=a[13];b[14]=a[14];b[15]=a[15];return b};mat4.identity=function(a){a||(a=mat4.create());a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};
mat4.transpose=function(a,b){if(!b||a===b){var c=a[1],d=a[2],e=a[3],f=a[6],g=a[7],j=a[11];a[1]=a[4];a[2]=a[8];a[3]=a[12];a[4]=c;a[6]=a[9];a[7]=a[13];a[8]=d;a[9]=f;a[11]=a[14];a[12]=e;a[13]=g;a[14]=j;return a}b[0]=a[0];b[1]=a[4];b[2]=a[8];b[3]=a[12];b[4]=a[1];b[5]=a[5];b[6]=a[9];b[7]=a[13];b[8]=a[2];b[9]=a[6];b[10]=a[10];b[11]=a[14];b[12]=a[3];b[13]=a[7];b[14]=a[11];b[15]=a[15];return b};
mat4.determinant=function(a){var b=a[0],c=a[1],d=a[2],e=a[3],f=a[4],g=a[5],j=a[6],l=a[7],k=a[8],h=a[9],m=a[10],p=a[11],n=a[12],o=a[13],q=a[14],a=a[15];return n*h*j*e-k*o*j*e-n*g*m*e+f*o*m*e+k*g*q*e-f*h*q*e-n*h*d*l+k*o*d*l+n*c*m*l-b*o*m*l-k*c*q*l+b*h*q*l+n*g*d*p-f*o*d*p-n*c*j*p+b*o*j*p+f*c*q*p-b*g*q*p-k*g*d*a+f*h*d*a+k*c*j*a-b*h*j*a-f*c*m*a+b*g*m*a};
mat4.inverse=function(a,b){b||(b=a);var c=a[0],d=a[1],e=a[2],f=a[3],g=a[4],j=a[5],l=a[6],k=a[7],h=a[8],m=a[9],p=a[10],n=a[11],o=a[12],q=a[13],r=a[14],t=a[15],s=c*j-d*g,E=c*l-e*g,v=c*k-f*g,w=d*l-e*j,z=d*k-f*j,A=e*k-f*l,B=h*q-m*o,C=h*r-p*o,D=h*t-n*o,F=m*r-p*q,G=m*t-n*q,H=p*t-n*r,u=s*H-E*G+v*F+w*D-z*C+A*B;if(!u)return null;u=1/u;b[0]=(j*H-l*G+k*F)*u;b[1]=(-d*H+e*G-f*F)*u;b[2]=(q*A-r*z+t*w)*u;b[3]=(-m*A+p*z-n*w)*u;b[4]=(-g*H+l*D-k*C)*u;b[5]=(c*H-e*D+f*C)*u;b[6]=(-o*A+r*v-t*E)*u;b[7]=(h*A-p*v+n*E)*u;b[8]=
(g*G-j*D+k*B)*u;b[9]=(-c*G+d*D-f*B)*u;b[10]=(o*z-q*v+t*s)*u;b[11]=(-h*z+m*v-n*s)*u;b[12]=(-g*F+j*C-l*B)*u;b[13]=(c*F-d*C+e*B)*u;b[14]=(-o*w+q*E-r*s)*u;b[15]=(h*w-m*E+p*s)*u;return b};mat4.toRotationMat=function(a,b){b||(b=mat4.create());b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];b[9]=a[9];b[10]=a[10];b[11]=a[11];b[12]=0;b[13]=0;b[14]=0;b[15]=1;return b};
mat4.toMat3=function(a,b){b||(b=mat3.create());b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[4];b[4]=a[5];b[5]=a[6];b[6]=a[8];b[7]=a[9];b[8]=a[10];return b};mat4.toInverseMat3=function(a,b){var c=a[0],d=a[1],e=a[2],f=a[4],g=a[5],j=a[6],l=a[8],k=a[9],h=a[10],m=h*g-j*k,p=-h*f+j*l,n=k*f-g*l,o=c*m+d*p+e*n;if(!o)return null;o=1/o;b||(b=mat3.create());b[0]=m*o;b[1]=(-h*d+e*k)*o;b[2]=(j*d-e*g)*o;b[3]=p*o;b[4]=(h*c-e*l)*o;b[5]=(-j*c+e*f)*o;b[6]=n*o;b[7]=(-k*c+d*l)*o;b[8]=(g*c-d*f)*o;return b};
mat4.multiply=function(a,b,c){c||(c=a);var d=a[0],e=a[1],f=a[2],g=a[3],j=a[4],l=a[5],k=a[6],h=a[7],m=a[8],p=a[9],n=a[10],o=a[11],q=a[12],r=a[13],t=a[14],a=a[15],s=b[0],E=b[1],v=b[2],w=b[3],z=b[4],A=b[5],B=b[6],C=b[7],D=b[8],F=b[9],G=b[10],H=b[11],u=b[12],I=b[13],J=b[14],b=b[15];c[0]=s*d+E*j+v*m+w*q;c[1]=s*e+E*l+v*p+w*r;c[2]=s*f+E*k+v*n+w*t;c[3]=s*g+E*h+v*o+w*a;c[4]=z*d+A*j+B*m+C*q;c[5]=z*e+A*l+B*p+C*r;c[6]=z*f+A*k+B*n+C*t;c[7]=z*g+A*h+B*o+C*a;c[8]=D*d+F*j+G*m+H*q;c[9]=D*e+F*l+G*p+H*r;c[10]=D*f+F*
k+G*n+H*t;c[11]=D*g+F*h+G*o+H*a;c[12]=u*d+I*j+J*m+b*q;c[13]=u*e+I*l+J*p+b*r;c[14]=u*f+I*k+J*n+b*t;c[15]=u*g+I*h+J*o+b*a;return c};mat4.multiplyVec3=function(a,b,c){c||(c=b);var d=b[0],e=b[1],b=b[2];c[0]=a[0]*d+a[4]*e+a[8]*b+a[12];c[1]=a[1]*d+a[5]*e+a[9]*b+a[13];c[2]=a[2]*d+a[6]*e+a[10]*b+a[14];return c};
mat4.multiplyVec4=function(a,b,c){c||(c=b);var d=b[0],e=b[1],f=b[2],b=b[3];c[0]=a[0]*d+a[4]*e+a[8]*f+a[12]*b;c[1]=a[1]*d+a[5]*e+a[9]*f+a[13]*b;c[2]=a[2]*d+a[6]*e+a[10]*f+a[14]*b;c[3]=a[3]*d+a[7]*e+a[11]*f+a[15]*b;return c};
mat4.translate=function(a,b,c){var d=b[0],e=b[1],b=b[2],f,g,j,l,k,h,m,p,n,o,q,r;if(!c||a===c)return a[12]=a[0]*d+a[4]*e+a[8]*b+a[12],a[13]=a[1]*d+a[5]*e+a[9]*b+a[13],a[14]=a[2]*d+a[6]*e+a[10]*b+a[14],a[15]=a[3]*d+a[7]*e+a[11]*b+a[15],a;f=a[0];g=a[1];j=a[2];l=a[3];k=a[4];h=a[5];m=a[6];p=a[7];n=a[8];o=a[9];q=a[10];r=a[11];c[0]=f;c[1]=g;c[2]=j;c[3]=l;c[4]=k;c[5]=h;c[6]=m;c[7]=p;c[8]=n;c[9]=o;c[10]=q;c[11]=r;c[12]=f*d+k*e+n*b+a[12];c[13]=g*d+h*e+o*b+a[13];c[14]=j*d+m*e+q*b+a[14];c[15]=l*d+p*e+r*b+a[15];
return c};mat4.scale=function(a,b,c){var d=b[0],e=b[1],b=b[2];if(!c||a===c)return a[0]*=d,a[1]*=d,a[2]*=d,a[3]*=d,a[4]*=e,a[5]*=e,a[6]*=e,a[7]*=e,a[8]*=b,a[9]*=b,a[10]*=b,a[11]*=b,a;c[0]=a[0]*d;c[1]=a[1]*d;c[2]=a[2]*d;c[3]=a[3]*d;c[4]=a[4]*e;c[5]=a[5]*e;c[6]=a[6]*e;c[7]=a[7]*e;c[8]=a[8]*b;c[9]=a[9]*b;c[10]=a[10]*b;c[11]=a[11]*b;c[12]=a[12];c[13]=a[13];c[14]=a[14];c[15]=a[15];return c};
mat4.rotate=function(a,b,c,d){var e=c[0],f=c[1],c=c[2],g=Math.sqrt(e*e+f*f+c*c),j,l,k,h,m,p,n,o,q,r,t,s,E,v,w,z,A,B,C,D;if(!g)return null;1!==g&&(g=1/g,e*=g,f*=g,c*=g);j=Math.sin(b);l=Math.cos(b);k=1-l;b=a[0];g=a[1];h=a[2];m=a[3];p=a[4];n=a[5];o=a[6];q=a[7];r=a[8];t=a[9];s=a[10];E=a[11];v=e*e*k+l;w=f*e*k+c*j;z=c*e*k-f*j;A=e*f*k-c*j;B=f*f*k+l;C=c*f*k+e*j;D=e*c*k+f*j;e=f*c*k-e*j;f=c*c*k+l;d?a!==d&&(d[12]=a[12],d[13]=a[13],d[14]=a[14],d[15]=a[15]):d=a;d[0]=b*v+p*w+r*z;d[1]=g*v+n*w+t*z;d[2]=h*v+o*w+s*
z;d[3]=m*v+q*w+E*z;d[4]=b*A+p*B+r*C;d[5]=g*A+n*B+t*C;d[6]=h*A+o*B+s*C;d[7]=m*A+q*B+E*C;d[8]=b*D+p*e+r*f;d[9]=g*D+n*e+t*f;d[10]=h*D+o*e+s*f;d[11]=m*D+q*e+E*f;return d};mat4.rotateX=function(a,b,c){var d=Math.sin(b),b=Math.cos(b),e=a[4],f=a[5],g=a[6],j=a[7],l=a[8],k=a[9],h=a[10],m=a[11];c?a!==c&&(c[0]=a[0],c[1]=a[1],c[2]=a[2],c[3]=a[3],c[12]=a[12],c[13]=a[13],c[14]=a[14],c[15]=a[15]):c=a;c[4]=e*b+l*d;c[5]=f*b+k*d;c[6]=g*b+h*d;c[7]=j*b+m*d;c[8]=e*-d+l*b;c[9]=f*-d+k*b;c[10]=g*-d+h*b;c[11]=j*-d+m*b;return c};
mat4.rotateY=function(a,b,c){var d=Math.sin(b),b=Math.cos(b),e=a[0],f=a[1],g=a[2],j=a[3],l=a[8],k=a[9],h=a[10],m=a[11];c?a!==c&&(c[4]=a[4],c[5]=a[5],c[6]=a[6],c[7]=a[7],c[12]=a[12],c[13]=a[13],c[14]=a[14],c[15]=a[15]):c=a;c[0]=e*b+l*-d;c[1]=f*b+k*-d;c[2]=g*b+h*-d;c[3]=j*b+m*-d;c[8]=e*d+l*b;c[9]=f*d+k*b;c[10]=g*d+h*b;c[11]=j*d+m*b;return c};
mat4.rotateZ=function(a,b,c){var d=Math.sin(b),b=Math.cos(b),e=a[0],f=a[1],g=a[2],j=a[3],l=a[4],k=a[5],h=a[6],m=a[7];c?a!==c&&(c[8]=a[8],c[9]=a[9],c[10]=a[10],c[11]=a[11],c[12]=a[12],c[13]=a[13],c[14]=a[14],c[15]=a[15]):c=a;c[0]=e*b+l*d;c[1]=f*b+k*d;c[2]=g*b+h*d;c[3]=j*b+m*d;c[4]=e*-d+l*b;c[5]=f*-d+k*b;c[6]=g*-d+h*b;c[7]=j*-d+m*b;return c};
mat4.frustum=function(a,b,c,d,e,f,g){g||(g=mat4.create());var j=b-a,l=d-c,k=f-e;g[0]=2*e/j;g[1]=0;g[2]=0;g[3]=0;g[4]=0;g[5]=2*e/l;g[6]=0;g[7]=0;g[8]=(b+a)/j;g[9]=(d+c)/l;g[10]=-(f+e)/k;g[11]=-1;g[12]=0;g[13]=0;g[14]=-(2*f*e)/k;g[15]=0;return g};mat4.perspective=function(a,b,c,d,e){a=c*Math.tan(a*Math.PI/360);b*=a;return mat4.frustum(-b,b,-a,a,c,d,e)};
mat4.ortho=function(a,b,c,d,e,f,g){g||(g=mat4.create());var j=b-a,l=d-c,k=f-e;g[0]=2/j;g[1]=0;g[2]=0;g[3]=0;g[4]=0;g[5]=2/l;g[6]=0;g[7]=0;g[8]=0;g[9]=0;g[10]=-2/k;g[11]=0;g[12]=-(a+b)/j;g[13]=-(d+c)/l;g[14]=-(f+e)/k;g[15]=1;return g};
mat4.lookAt=function(a,b,c,d){d||(d=mat4.create());var e,f,g,j,l,k,h,m,p=a[0],n=a[1],a=a[2];g=c[0];j=c[1];f=c[2];h=b[0];c=b[1];e=b[2];if(p===h&&n===c&&a===e)return mat4.identity(d);b=p-h;c=n-c;h=a-e;m=1/Math.sqrt(b*b+c*c+h*h);b*=m;c*=m;h*=m;e=j*h-f*c;f=f*b-g*h;g=g*c-j*b;(m=Math.sqrt(e*e+f*f+g*g))?(m=1/m,e*=m,f*=m,g*=m):g=f=e=0;j=c*g-h*f;l=h*e-b*g;k=b*f-c*e;(m=Math.sqrt(j*j+l*l+k*k))?(m=1/m,j*=m,l*=m,k*=m):k=l=j=0;d[0]=e;d[1]=j;d[2]=b;d[3]=0;d[4]=f;d[5]=l;d[6]=c;d[7]=0;d[8]=g;d[9]=k;d[10]=h;d[11]=
0;d[12]=-(e*p+f*n+g*a);d[13]=-(j*p+l*n+k*a);d[14]=-(b*p+c*n+h*a);d[15]=1;return d};mat4.fromRotationTranslation=function(a,b,c){c||(c=mat4.create());var d=a[0],e=a[1],f=a[2],g=a[3],j=d+d,l=e+e,k=f+f,a=d*j,h=d*l,d=d*k,m=e*l,e=e*k,f=f*k,j=g*j,l=g*l,g=g*k;c[0]=1-(m+f);c[1]=h+g;c[2]=d-l;c[3]=0;c[4]=h-g;c[5]=1-(a+f);c[6]=e+j;c[7]=0;c[8]=d+l;c[9]=e-j;c[10]=1-(a+m);c[11]=0;c[12]=b[0];c[13]=b[1];c[14]=b[2];c[15]=1;return c};
mat4.str=function(a){return"["+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+", "+a[9]+", "+a[10]+", "+a[11]+", "+a[12]+", "+a[13]+", "+a[14]+", "+a[15]+"]"};quat4.create=function(a){var b=new MatrixArray(4);a&&(b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3]);return b};quat4.set=function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];return b};
quat4.calculateW=function(a,b){var c=a[0],d=a[1],e=a[2];if(!b||a===b)return a[3]=-Math.sqrt(Math.abs(1-c*c-d*d-e*e)),a;b[0]=c;b[1]=d;b[2]=e;b[3]=-Math.sqrt(Math.abs(1-c*c-d*d-e*e));return b};quat4.dot=function(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]+a[3]*b[3]};quat4.inverse=function(a,b){var c=a[0],d=a[1],e=a[2],f=a[3],c=(c=c*c+d*d+e*e+f*f)?1/c:0;if(!b||a===b)return a[0]*=-c,a[1]*=-c,a[2]*=-c,a[3]*=c,a;b[0]=-a[0]*c;b[1]=-a[1]*c;b[2]=-a[2]*c;b[3]=a[3]*c;return b};
quat4.conjugate=function(a,b){if(!b||a===b)return a[0]*=-1,a[1]*=-1,a[2]*=-1,a;b[0]=-a[0];b[1]=-a[1];b[2]=-a[2];b[3]=a[3];return b};quat4.length=function(a){var b=a[0],c=a[1],d=a[2],a=a[3];return Math.sqrt(b*b+c*c+d*d+a*a)};quat4.normalize=function(a,b){b||(b=a);var c=a[0],d=a[1],e=a[2],f=a[3],g=Math.sqrt(c*c+d*d+e*e+f*f);if(0===g)return b[0]=0,b[1]=0,b[2]=0,b[3]=0,b;g=1/g;b[0]=c*g;b[1]=d*g;b[2]=e*g;b[3]=f*g;return b};
quat4.multiply=function(a,b,c){c||(c=a);var d=a[0],e=a[1],f=a[2],a=a[3],g=b[0],j=b[1],l=b[2],b=b[3];c[0]=d*b+a*g+e*l-f*j;c[1]=e*b+a*j+f*g-d*l;c[2]=f*b+a*l+d*j-e*g;c[3]=a*b-d*g-e*j-f*l;return c};quat4.multiplyVec3=function(a,b,c){c||(c=b);var d=b[0],e=b[1],f=b[2],b=a[0],g=a[1],j=a[2],a=a[3],l=a*d+g*f-j*e,k=a*e+j*d-b*f,h=a*f+b*e-g*d,d=-b*d-g*e-j*f;c[0]=l*a+d*-b+k*-j-h*-g;c[1]=k*a+d*-g+h*-b-l*-j;c[2]=h*a+d*-j+l*-g-k*-b;return c};
quat4.toMat3=function(a,b){b||(b=mat3.create());var c=a[0],d=a[1],e=a[2],f=a[3],g=c+c,j=d+d,l=e+e,k=c*g,h=c*j,c=c*l,m=d*j,d=d*l,e=e*l,g=f*g,j=f*j,f=f*l;b[0]=1-(m+e);b[1]=h+f;b[2]=c-j;b[3]=h-f;b[4]=1-(k+e);b[5]=d+g;b[6]=c+j;b[7]=d-g;b[8]=1-(k+m);return b};
quat4.toMat4=function(a,b){b||(b=mat4.create());var c=a[0],d=a[1],e=a[2],f=a[3],g=c+c,j=d+d,l=e+e,k=c*g,h=c*j,c=c*l,m=d*j,d=d*l,e=e*l,g=f*g,j=f*j,f=f*l;b[0]=1-(m+e);b[1]=h+f;b[2]=c-j;b[3]=0;b[4]=h-f;b[5]=1-(k+e);b[6]=d+g;b[7]=0;b[8]=c+j;b[9]=d-g;b[10]=1-(k+m);b[11]=0;b[12]=0;b[13]=0;b[14]=0;b[15]=1;return b};
quat4.slerp=function(a,b,c,d){d||(d=a);var e=a[0]*b[0]+a[1]*b[1]+a[2]*b[2]+a[3]*b[3],f,g;if(1<=Math.abs(e))return d!==a&&(d[0]=a[0],d[1]=a[1],d[2]=a[2],d[3]=a[3]),d;f=Math.acos(e);g=Math.sqrt(1-e*e);if(0.0010>Math.abs(g))return d[0]=0.5*a[0]+0.5*b[0],d[1]=0.5*a[1]+0.5*b[1],d[2]=0.5*a[2]+0.5*b[2],d[3]=0.5*a[3]+0.5*b[3],d;e=Math.sin((1-c)*f)/g;c=Math.sin(c*f)/g;d[0]=a[0]*e+b[0]*c;d[1]=a[1]*e+b[1]*c;d[2]=a[2]*e+b[2]*c;d[3]=a[3]*e+b[3]*c;return d};
quat4.str=function(a){return"["+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+"]"};
(function(){"undefined"===typeof Array.prototype.add&&(Array.prototype.add=function(a){this.push(a);return this});"undefined"===typeof Array.prototype.remove&&(Array.prototype.remove=function(a){a=this.indexOf(a);0<=a&&this.splice(a,1);return this});"undefined"===typeof Array.prototype.last&&Object.defineProperty(Array.prototype,"last",{get:function(){return this[this.length-1]},enumerable:!1});"undefined"===typeof Array.prototype.first&&Object.defineProperty(Array.prototype,"first",{get:function(){return this[0]},
enumerable:!1})})();(function(){L7.rand=function(a,b,c){_.isUndefined(c)&&(c=!1);var d=_.isNumber(b)?a:0,a=_.isNumber(b)?b:a,b=Math.random()*(a-d)+d;return d===(d|0)&&a===(a|0)&&!c?Math.floor(b):b};L7.coin=function(){return 0===L7.rand(0,2)};L7.degreesToRadians=function(a){return(a||0)*Math.PI/180};L7.radiansToDegrees=function(a){return 180*(a||0)/Math.PI}})();
i.BackgroundFiller={fill:function(a){a.ani.sequence(function(b){b.wait(16200);b.repeat(Infinity,function(b){b.shimmer({targets:a.query(function(a){return 193===a.color[0]}),minAlpha:0.2,maxAlpha:0.9,baseRate:1E3,rateVariance:0.4,color:[250,250,120,1]})})})}};
(function(){var a={facebook:"http://www.facebook.com/sharer.php?u=",twitter:"https://twitter.com/home?status=Check out Lab Adder, an upcoming HTML5 game: ",gplus:"https://plusone.google.com/_/+1/confirm?hl=en&url="};i.ChromeFiller={fill:function(a){this._board=a;a.tiles.forEach(function(a){a.opaque=!0});this._addClickActor(a,"facebook",L7.p(124,2));this._addClickActor(a,"gplus",L7.p(134,2));this._addClickActor(a,"twitter",L7.p(144,2))},_addClickActor:function(b,c,d){d=new L7.Actor({color:[0,0,0,0],
position:d,shape:[[5,1,1,1,1,1],[1,1,1,1,1,1],[1,1,1,1,1,1],[1,1,1,1,1,1],[1,1,1,1,1,1],[1,1,1,1,1,1]]});b.addActor(d);d.on("click",function(){window.open(a[c]+window.location,"_blank","channelmode=0,directories=0,fullscreen=0,location=1,width=500,height=500")})},_addPlayButton:function(a){this.playButton||(this.playButton=new L7.Actor({color:[212,212,212,1],shape:[[5,0,0,0],[1,1,1,0],[1,1,1,1],[1,1,1,0],[1,0,0,0]],position:L7.p(2,3)}),this.playButton.on("click",this._togglePause,this));a.addActor(this.playButton)},
_addPauseButton:function(a){var c=[212,212,212,1],d=[0,0,0,0];this.pauseButton||(this.pauseButton=new L7.Actor({shape:[[5,1,1,1,1],[1,1,1,1,1],[1,1,1,1,1],[1,1,1,1,1],[1,1,1,1,1]],color:[[c,c,d,c,c],[c,c,d,c,c],[c,c,d,c,c],[c,c,d,c,c],[c,c,d,c,c]],position:L7.p(2,3)}),this.pauseButton.on("click",this._togglePause,this));a.addActor(this.pauseButton)},_togglePause:function(a){a.board.game.paused=!a.board.game.paused;a.board.game.paused?(this.pauseButton&&this._board.removeActor(this.pauseButton),this._addPlayButton(this._board)):
(this.playButton&&this._board.removeActor(this.playButton),this._addPauseButton(this._board))}}})();(function(){var a={team:"apple",color:[255,0,0,1],die:function(){this.board&&this.board.removeActor(this);this.fireEvent("death",this)}};i.ClassicApple=function(b){return new L7.Actor(_.extend(b||{},a))}})();
(function(){var a=[],b=[],c={keyInputs:{left:{repeat:!1,handler:function(){this.setDirection(i.Direction.West)}},right:{repeat:!1,handler:function(){this.setDirection(i.Direction.East)}},up:{repeat:!1,handler:function(){this.setDirection(i.Direction.North)}},down:{repeat:!1,handler:function(){this.setDirection(i.Direction.South)}}},setDirection:function(a){if(!this._directionPending){var b=this.direction.add(a);0!==b.x&&0!==b.y&&(this.direction=a,this._directionPending=!0)}},team:"snake",hitDetection:{enabled:function(){return this.active},
apple:function(a,b){i.sounds.bite.play({volume:L7.rand(50,100)});this.grow();b.die()}},color:[0,255,0,1],moveSnake:function(){for(var a=this.pieces.length-1;0<a;--a){var b=this.pieces[a];this.board.movePiece({piece:b,from:b.position,to:b.nextPosition});var c=this.pieces[a-1];b.position=c.position;b.nextPosition=c.nextPosition}a=this.pieces.first;this.board.movePiece({piece:a,from:a.position,to:a.nextPosition});a.position=a.nextPosition;a.nextPosition=a.nextPosition.add(this.direction);this.position=
a.position;this._directionPending=!1},addPiece:function(){var c,e;1===this.pieces.length?(e=this.pieces.last.position,c=e.add(this.direction.negate())):(delta=this.pieces.last.position.delta(this.pieces[this.pieces.length-2].position),c=this.pieces.last.position.add(delta),e=this.pieces.last.position);c={position:c,nextPosition:e,color:this.color,owner:this,scale:0.85};this.pieces.push(c);for(e=0;e<this.pieces.length-1;++e)this.pieces[e].scale=1;this.board&&(this.board.movePiece({piece:c,from:c.position,
to:c.position}),this.pieces.length-1&1?b.push(c):a.push(c))},grow:function(){this.board?this.doEatAnimation():this.addPiece()},doEatAnimation:function(){var a=this;this.ani.sequence(function(b){a.pieces.forEach(function(a){b.tween({targets:[a],property:"scale",from:1,to:1.5,duration:75});b.tween({targets:[a],property:"scale",from:1.5,to:1,duration:75})});b.invoke(function(){a.addPiece()});b.end()})},burp:function(){var a=[this.pieces[0]];this.ani.sequence(function(b){b.wait(2800);b.tween({targets:a,
property:"scale",from:1,to:1.75,duration:100,jitterMin:0,jitterMax:0.2});b.invoke(function(){i.sounds.burp.play()});b.tween({targets:a,property:"scale",from:1.75,to:1.75,jitterMin:-0.1,jitterMax:0.2,duration:400});b.tween({targets:a,property:"scale",from:1.75,to:1,duration:75})})},update:function(a,b){L7.Actor.prototype.update.call(this,a,b);if(this.active){this.script&&this.curScript<this.script.length-1&&(this.position.equals(this.script[this.curScript].p)&&(this.rate=this.script[this.curScript].r||
this.rate,this.curScript+=1,this.direction=this.script[this.curScript].p.delta(this.script[this.curScript-1].p).normalize(),this.pieces.first.nextPosition=this.position.add(this.direction)),this.curScript===this.script.length-1&&this.fireEvent("scriptdone",this));this._offsetElapsed+=a;this._offsetElapsed>=this.rate&&(this._offsetElapsed-=this.rate,this.moveSnake());var c=this._offsetElapsed/this.rate;this.pieces.forEach(function(a){if(a.nextPosition){var b=a.nextPosition.delta(a.position);a.offset=
{x:c*b.x,y:c*b.y}}});this.hitManager.detectHitsForActor(this)}}};i.ClassicSnake=function(a){var a=_.extend({rate:1E3,direction:window.i.Direction.East,active:!1},a),b=new L7.Actor(_.extend(a,c));b._offsetElapsed=0;b.script&&(b.curScript=0);b.pieces=[new L7.Piece({position:b.position,nextPosition:b.position.add(b.direction),color:[0,150,0,1],owner:b,scale:1})];for(var f=a.size||1,g=1;g<f;++g)b.grow();a.dontGrow&&(b.grow=function(){});b.hitManager=new L7.HitManager;Object.defineProperty(b,"board",{get:function(){return this._board},
set:function(a){this._board=a}});return b}})();(function(){i.Direction={North:L7.p(0,-1),East:L7.p(1,0),South:L7.p(0,1),West:L7.p(-1,0)}})();
(function(){var a=[121,133,164,1];i.FillerUtil={pulsate:function(a,c){a.ani.repeat(Infinity,function(d){d.shimmer({targets:[a.tileAt(c)],minAlpha:0,maxAlpha:0.9,baseRate:600,rateVariance:0})})},addSmoke:function(a,c,d,e){e=e||2;c=new L7.ParticleSystem({totalParticles:50,duration:Infinity,gravity:L7.p(),centerOfGravity:L7.p(),angle:-90,angleVar:8,speed:2,speedVar:1,radialAccel:0,radialAccelVar:0,tangentialAccel:0,tangentialAccelVar:0,position:c,posVar:L7.p(d,1),life:e,lifeVar:0.15,emissionRate:50/
e,startColor:L7.Color.fromFloats(0.5,0.5,0.5,1),startColorVar:[0,0,0,0],endColor:L7.Color.fromFloats(1,1,1,0.25),endColorVar:[0,0,0,0],active:!0});a.addDaemon(c)},addSparks:function(a,c){var d=new L7.ParticleSystem({totalParticles:10,duration:Infinity,gravity:L7.p(0,0),centerOfGravity:L7.p(),angle:-70,angleVar:30,speed:40,speedVar:3,radialAccel:10,radialAccelVar:2,tangentialAccel:0,tangentialAccelVar:0,position:c,posVar:L7.p(),life:0.3,lifeVar:0,emissionRate:10,startColor:[255,255,200,1],startColorVar:[10,
10,0,0],endColor:[255,255,255,0.25],endColorVar:[0,0,0,0],active:!0,startSize:0.75,startSizeVar:0,endSize:0.75,endSizeVar:0});a.addDaemon(d)},addWater:function(a,c,d,e){c=new L7.ParticleSystem({totalParticles:4,duration:Infinity,gravity:L7.p(),centerOfGravity:L7.p(),angle:-90,angleVar:0,speed:4,speedVar:0.4,radialAccel:0,radialAccelVar:0,tangentialAccel:0,tangentialAccelVar:0,position:L7.p(c.x+d/2,c.y+e),posVar:L7.p(d/2,0),life:0.7,lifeVar:0.15,emissionRate:4,startColor:[255,255,255,1],startColorVar:[0,
0,0,0],endColor:[145,220,255,1],endColorVar:[0,0,0,0],active:!0});a.addDaemon(c)},addHighWater:function(a,c,d,e){c=new L7.ParticleSystem({totalParticles:30,duration:Infinity,gravity:L7.p(),centerOfGravity:L7.p(),angle:-90,angleVar:0,speed:3,speedVar:0.6,radialAccel:0,radialAccelVar:0,tangentialAccel:0,tangentialAccelVar:0,position:L7.p(c.x+d/2,c.y+e),posVar:L7.p(d/2,0),life:5,lifeVar:0.15,emissionRate:7,startColor:[255,255,255,1],startColorVar:[0,0,0,0],endColor:[145,220,255,1],endColorVar:[0,0,0,
0],active:!0});a.addDaemon(c)},addBlueScreen:function(a,c,d,e){function f(){for(var a=c.x,b=c.x+d;a<b;++a)for(var f=c.y,h=c.y+e;f<h;++f){var k=p.pieceAt(a,f);33>L7.rand(0,100)?(k.color=g,k.scale=0.6):(k.color=j,k.scale=0)}}for(var g=[255,255,255,1],j=[0,0,255,1],l=[],k=0;k<e;++k){for(var h=[],m=0;m<d;++m)h.push(1);l.push(h)}l[0][0]=5;var p=new L7.Actor({shape:l,position:c});a.addActor(p);p.ani.repeat(Infinity,function(a){a.invoke(f);a.waitBetween(1E3,3E3)})},addBarGraph:function(b,c,d,e,f){function g(){for(var b=
c.x,g=c.x+d;b<g;++b)for(var h=L7.rand(0,e)+c.y,j=c.y,k=c.y+e;j<k;++j)m.pieceAt(b,j).color=j>=h?f:a}for(var f=f||[240,186,89,1],j=[],l=0;l<e;++l){for(var k=[],h=0;h<d;++h)k.push(1);j.push(k)}j[0][0]=5;var m=new L7.Actor({shape:j,position:c});b.addActor(m);m.ani.repeat(Infinity,function(a){a.invoke(g);a.waitBetween(100,1E3)})},addHeartWave:function(b,c,d,e,f){function g(){for(var b=c.x,g=c.x+d;b<g;++b)for(var h=c.y,j=c.y+e;h<j;++h){var k=m.pieceAt(b,h);k.color=k.position.equals(p)||k.position.y===n&&
k.position.x!==p.x?f:a}p=p.add(1,0);p.x>=c.x+d&&(p=c.add(0,1))}for(var f=f||[255,255,0,1],j=[],l=0;l<e;++l){for(var k=[],h=0;h<d;++h)k.push(1);j.push(k)}j[0][0]=5;var m=new L7.Actor({shape:j,position:c});b.addActor(m);var p=c.add(0,1),n=c.y+2;m.ani.repeat(Infinity,function(a){a.invoke(g);a.wait(400)})},addSinWave:function(a,c,d,e,f){function g(){for(var a=n.pieces.length;a--;)n.pieces[a].color=l;for(a=0;a<d;++a){var b=c.x+a,g=Math.sin(o+a)*((e-1)/2)|0,h=c.y+e/2+g|0,h=n.pieceAt(b,h);h.color=f;g=-g;
h=c.y+e/2+g|0;h=n.pieceAt(b,h);h.color=j}++o}for(var f=f||[255,255,0,1],j=[0,0,255,1],l=[100,100,100,1],k=[],h=0;h<e;++h){for(var m=[],p=0;p<d;++p)m.push(1);k.push(m)}k[0][0]=5;var n=new L7.Actor({shape:k,position:c});a.addActor(n);var o=0;n.ani.repeat(Infinity,function(a){a.invoke(g);a.wait(600)})}}})();
i.ForegroundFiller={fill:function(a){i.FillerUtil.addWater(a,L7.p(1,1),3,8);i.FillerUtil.addWater(a,L7.p(61,4),2,7);i.FillerUtil.addWater(a,L7.p(126,7),9,4);a.ani.repeat(Infinity,function(b){b.shimmer({targets:a.rect(22,7,4,5),minAlpha:0.4,maxAlpha:0.7,baseRate:500,rateVariance:0.2})});this._addFirstAlien(a);this._addSecondAlien(a);i.FillerUtil.addSmoke(a,L7.p(209,10),3,3);i.FillerUtil.pulsate(a,L7.p(63,1));i.FillerUtil.pulsate(a,L7.p(63,3));i.FillerUtil.pulsate(a,L7.p(133,13));i.FillerUtil.pulsate(a,
L7.p(137,13))},_addFirstAlien:function(a){var b=[179,14,52,1],c=[128,11,37,1],d=new L7.Actor({position:L7.p(2,4),shape:[[0,5,1,0],[1,1,1,1],[1,1,1,1],[1,0,1,0]],color:[[null,b,b,null],[c,b,[98,108,36,1],b],[c,c,b,b],[c,null,c,null]]});a.addActor(d);d.ani.repeat(Infinity,function(a){a.waitBetween(600,2E3);a.invoke(function(){d.down(1)});a.waitBetween(600,2500);a.invoke(function(){d.up(1)})})},_addSecondAlien:function(a,b){var c=[179,14,52,1],d=[128,11,37,1],e=[98,108,36,1],f=new L7.Actor({position:b||
L7.p(130,8),shape:[[0,5,1,1,0],[1,1,1,1,1],[1,1,1,1,1],[1,0,1,0,1]],color:[[null,c,c,c,null],[d,e,c,e,c],[d,d,c,c,c],[d,null,d,null,d]]});a.addActor(f);f.ani.repeat(Infinity,function(a){a.waitBetween(600,2E3);a.invoke(function(){f.left(1)});a.waitBetween(300,700);a.invoke(function(){f.left(1)});a.waitBetween(800,2E3);a.invoke(function(){f.right(1)});a.waitBetween(800,2E3);a.invoke(function(){f.right(1)})})}};L7.useWebGL=!(0<window.location.href.toLowerCase().indexOf("canvas"));
function lightSwitchBoard(a,b,c,d){var e=a.query(function(a){return a.color&&0!==a.color[3]});a.ani.sequence({targets:e},function(e){e.copyProperty({srcProperty:"overlayColor",destProperty:"_overlayColorSaved"});e.copyProperty({srcProperty:"opaque",destProperty:"_opaqueSaved"});e.setProperty({property:"opaque",value:!0});e.setProperty({property:"overlayColor",value:c||[0,0,0,1]});e.wait(b);e.invoke(function(){i.sounds.lightswitch.play({volume:d})});e.copyProperty({srcProperty:"_overlayColorSaved",
destProperty:"overlayColor"});e.copyProperty({srcProperty:"_opaqueSaved",destProperty:"opaque"});e.invoke(function(){delete a.standardBorderColor;a.borderFill=[0,0,0,1]})})}
function onImagesLoaded(a){var b=[],c=[4,0,1,2,0,0,0],d=[7,11,15,19,6,6,6],e=[16E3,13E3,9800,5700],f=[[40,40,40,1],void 0,void 0,void 0],g=[20,40,60,90],j=[i.BackgroundFiller,i.MidBackgroundFiller,i.MidForegroundFiller,i.ForegroundFiller,void 0,i.ChromeFiller,void 0],l=[a.background,a.midBackground,a.midForeground,a.foreground,a.overlay,a.chrome,a.outro];l.forEach(function(a,h){var k=(new L7.ColorLevelLoader(a,d[h],c[h])).load();k.parallaxRatio=0.6*h;k.disableHitDetection=!0;j[h]&&j[h].fill(k);e[h]&&
lightSwitchBoard(k,e[h],f[h],g[h]);b.push(k)});b[0].borderFill=f[0];var a=new L7.ParallaxBoard({boards:b}),k=b[3],h=b[b.length-2];h.offsetY=-k.pixelHeight;h.parallaxRatio=0;var m=document.getElementById("fpsContainer");m.style.display=0<window.location.href.toLowerCase().indexOf("showfps")?"":"none";var p=document.getElementById("introContainer");p.innerHTML="";var n=new L7.Game({board:a,width:3*k.pixelHeight,height:k.pixelHeight+h.pixelHeight,initialAnchor:L7.p(),container:p,fpsContainer:m});console.log("game width: "+
n.width);console.log("game height: "+n.height);var o=b.last;o.parallaxRatio=0;o.visible=!1;o.tiles.forEach(function(a){a.color[3]=0});n.on("pausechanged",function(a){a?soundManager.pauseAll():soundManager.resumeAll()});n.fpsContainer.innerHTML="webgl? "+L7.useWebGL;n.paused=!0;var q=new i.ClassicSnake({position:L7.p(-20,15),script:[{p:L7.p(14,15)},{p:L7.p(14,17)},{p:L7.p(27,17)},{p:L7.p(27,13)},{p:L7.p(44,13)},{p:L7.p(44,16)},{p:L7.p(68,16)},{p:L7.p(68,15)},{p:L7.p(80,15)},{p:L7.p(80,17)},{p:L7.p(75,
17)},{p:L7.p(75,14)},{p:L7.p(91,14)},{p:L7.p(91,16)},{p:L7.p(103,16)},{p:L7.p(106,16)},{p:L7.p(106,14)},{p:L7.p(110,14)},{p:L7.p(110,17)},{p:L7.p(114,17)},{p:L7.p(114,14)},{p:L7.p(127,14)},{p:L7.p(127,9)},{p:L7.p(142,9)},{p:L7.p(142,15)},{p:L7.p(228,15)},{p:L7.p(228,13)},{p:L7.p(155,13)},{p:L7.p(154,13)}],direction:i.Direction.East,size:4,active:!1,rate:170});q.on("scriptdone",function(a){a.active=!1;a.burp()});b[2].addActor(q);[L7.p(44,15),L7.p(71,15),L7.p(107,14),L7.p(113,17),L7.p(138,9),L7.p(167,
13),L7.p(173,13),L7.p(175,13),L7.p(179,13)].forEach(function(a){a=new i.ClassicApple({position:a});b[2].addActor(a)});var r=b[4];r.tiles.forEach(function(a){a.opaque=!0});r.clicked=function(){n.paused=!1;i.ChromeFiller._addPauseButton(h)};k.ani.together(function(a){a.sequence(function(a){a.wait(500);a.tween({targets:r.tiles,property:"color",to:[0,0,0,0],duration:2E3});a.invoke(function(){r.destroy();b.remove(r)});a.invoke(function(){i.sounds.bubbles.setVolume(10);i.sounds.bubbles.play({loops:200,
volume:10})});a.repeat(9,function(a){a.wait(3E3);a.invoke(function(){i.sounds.bubbles.setVolume(i.sounds.bubbles.volume+10)})})});a.sequence(function(a){a.wait(6E3);var b=(k.tileSize+k.borderWidth)*l[3].width,b=b-n.width,b=(b-85)/k.parallaxRatio,b=b|0;a.invoke(function(){q.active=!0});a.repeat(b,function(a){a.invoke(function(){n.viewport.scrollX(1)});a.wait(10)});a.wait(23E3);a.setProperty({targets:[o],property:"visible",value:!0});a.together(function(a){a.repeat(10,function(a){a.wait(300);a.invoke(function(){i.sounds.bubbles.setVolume(i.sounds.bubbles.volume-
10)})});a.fadeIn({targets:o.tiles,duration:4E3})});a.wait(1E3);a.invoke(function(){n.paused=!0})})});a=new L7.Actor({color:[0,0,0,0],position:L7.p(500,5),keyInputs:{left:{repeat:!0,handler:function(){n.viewport.scrollX(-3)}},right:{repeat:!0,handler:function(){n.viewport.scrollX(3)}}}});k.addActor(a);n.go()}
if(L7.isSupportedBrowser)soundManager.onready(function(){i.sounds={bubbles:soundManager.createSound({id:"bubbles",url:"audio/bubbles.mp3"}),lightswitch:soundManager.createSound({id:"lightswitch",url:"audio/switch.mp3",autoLoad:!0}),bite:soundManager.createSound({id:"bite",url:"audio/bite.mp3",autoLoad:!0}),burp:soundManager.createSound({id:"burp",url:"audio/burp.mp3",autoLoad:!0})};new L7.ImageLoader({srcs:"background.png,midBackground.png,midForeground.png,foreground.png,overlay.png,chrome.png,outro.png".split(","),
handler:onImagesLoaded,loadNow:!0})});else{var container=document.getElementById("introContainer");container.innerHTML='<img id="browserSupportImg" src="browserSupportBigG.gif" alt="supported browsers" /><div>Sorry, your browser is lacking features needed by Lab Adder. So far Lab Adder works in Chrome (recommended) or the latest Firefox</div>'}
(function(){i.MidBackgroundFiller={fill:function(a){i.FillerUtil.addBarGraph(a,L7.p(12,5),5,4);i.FillerUtil.addWater(a,L7.p(28,5),3,7);i.FillerUtil.addHighWater(a,L7.p(128,2),30,18);i.FillerUtil.addSmoke(a,L7.p(104,7),1)}}})();
i.MidForegroundFiller={fill:function(a){this._addControlPanelShimmer(a,a.rect(137,11,5,3));i.FillerUtil.addWater(a,L7.p(6,5),2,6);i.FillerUtil.addWater(a,L7.p(75,1),2,5);i.FillerUtil.addBlueScreen(a,L7.p(129,11),5,3);i.FillerUtil.addBlueScreen(a,L7.p(66,11),8,3);i.FillerUtil.pulsate(a,L7.p(64,11));i.FillerUtil.pulsate(a,L7.p(63,13));i.FillerUtil.addHeartWave(a,L7.p(30,9),5,4);i.FillerUtil.pulsate(a,L7.p(30,14));i.FillerUtil.pulsate(a,L7.p(32,14));i.FillerUtil.pulsate(a,L7.p(34,14));i.FillerUtil.addBarGraph(a,
L7.p(46,8),4,7,[0,255,0,1]);i.FillerUtil.pulsate(a,L7.p(79,10));i.FillerUtil.pulsate(a,L7.p(81,10));i.FillerUtil.pulsate(a,L7.p(83,10));i.FillerUtil.addSinWave(a,L7.p(91,1),7,5,[255,0,0,1])},_addControlPanelShimmer:function(a,b){a.ani.repeat(Infinity,function(a){a.shimmer({targets:b,minAlpha:0.4,maxAlpha:0.7,baseRate:500,rateVariance:0.2})})}};
